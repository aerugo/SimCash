# Experiment 3: Three-Period Dummy Example (Castro-Compliant)
#
# Replicates Castro et al. (2025) Section 7.2:
# - P^A = P^B = [0.2, 0.2, 0] - symmetric, deterministic payment demands
# - Joint learning of initial liquidity and payment timing
# - Uses liquidity_pool mode (direct balance) for Castro compliance
#
# Expected outcome: Both agents ~25% initial liquidity

name: exp3
description: "Three-Period Dummy - Joint Liquidity & Timing (Castro-Compliant)"

# Scenario configuration (relative to this file's directory)
scenario: ../configs/exp3_joint.yaml

# Evaluation settings
# Use deterministic mode since the scenario has fixed payments
evaluation:
  mode: deterministic
  num_samples: 50  # For statistical rigor
  ticks: 3

# Convergence criteria
convergence:
  max_iterations: 25
  stability_threshold: 0.05
  stability_window: 5

# LLM configuration
llm:
  model: "openai:gpt-5.2"  # always use gpt-5.2 with high reasoning
  temperature: 0.5
  max_retries: 3
  timeout_seconds: 900
  reasoning_effort: "high"

# Prompt customization for joint learning
prompt_customization:
  all: |
    ## Experiment Focus: Joint Liquidity & Timing Optimization

    This is the **Three-Period Dummy Example**:
    - 3 periods total: t=0, t=1, t=2
    - Symmetric payments: Each bank owes 20% of liquidity pool at t=0 and t=1
    - No new payments at t=2
    - Total payment obligation: 40% of liquidity pool (0.2 + 0.2)

    **CRITICAL CONSTRAINT:**
    - You have NO unsecured credit line (unsecured_cap = 0)
    - You have NO overdraft capability (hard liquidity constraint)
    - The ONLY way to get liquidity is by allocating from your liquidity_pool
    - If you don't allocate enough, you CANNOT make payments â†’ gridlock!

    **You must optimize TWO decisions:**

    1. **Initial Liquidity (at simulation start):** What fraction of pool to allocate?
       - Use `initial_liquidity_fraction` parameter (0.0 to 1.0)
       - Allocated liquidity becomes your opening balance
       - But allocated liquidity has opportunity cost (r_c per tick)
       - Consider: Total obligations are 40% of pool over 2 periods

    2. **Payment Timing (each tick):** Release or hold queued payments?
       - Releasing uses liquidity but avoids delay costs (r_d)
       - Holding preserves liquidity but incurs delay costs
       - Key rule: r_c < r_d (allocating liquidity is CHEAPER than delaying)

    **Cost Tradeoff:**
    - r_c = liquidity cost (cheaper)
    - r_d = delay cost (more expensive)
    - Since r_c < r_d, it's better to allocate more liquidity than delay payments

    **Key Insight:** With symmetric payments, incoming payments from the other bank
    can offset your outgoing payments. But you need SOME initial liquidity to
    break the circular dependency (both banks need payments to make payments).

# Policy constraints (Castro-specific - MINIMAL SET)
policy_constraints:
  allowed_parameters:
    - name: initial_liquidity_fraction
      param_type: float
      min_value: 0.0
      max_value: 1.0
      description: "Fraction of liquidity_pool to allocate at simulation start. Value between 0.0 and 1.0."

  allowed_fields:
    # Time context
    - system_tick_in_day
    # Agent liquidity state (balance = allocated liquidity from pool)
    - balance
    # Queue state (for timing decisions)
    - queue1_total_value
    - outgoing_queue_size
    # Transaction context
    - ticks_to_deadline

  allowed_actions:
    payment_tree:
      - Release
      - Hold
    bank_tree:
      - NoAction
    # Note: strategic_collateral_tree not used in liquidity_pool mode
    # Allocation happens at simulation start via liquidity_allocation_fraction

# Agents to optimize
optimized_agents:
  - BANK_A
  - BANK_B

# Output settings
output:
  directory: results
  database: exp3.db
  verbose: true

# Master seed for reproducibility
master_seed: 42
