# Castro et al. (2025) - 12-Period LVTS-Style Scenario (CASTRO-ALIGNED)
# Replicates Section 7.1 for stochastic environment validation
#
# CASTRO ALIGNMENT FEATURES ENABLED:
#   - deferred_crediting: true  (credits applied at end of tick)
#   - deadline_cap_at_eod: true (all deadlines capped at day end)
#   - LSM disabled (RTGS without netting, as per Castro model)
#
# CASTRO POLICY CONSTRAINTS (enforced by castro_mode=True in experiment script):
#   - Initial liquidity decision at t=0 ONLY (no mid-day collateral changes)
#   - Payment actions: Only Release (x_t=1) or Hold (x_t=0), no Split
#   - No ReleaseWithCredit (no interbank credit lines in Castro model)
#   - No reactive collateral tree (end_of_tick_collateral_tree)
#
# Key differences from previous runs:
#   1. Credits deferred to end of tick - no within-tick recycling
#   2. All deadlines capped at day end - same-day settlement required
#   3. Unlimited credit via high unsecured_cap (Castro model assumption)
#
# Expected behavior:
#   - Higher initial liquidity needed (can't rely on recycling)
#   - More conservative payment timing
#   - Similar policy convergence to Castro's RL results

simulation:
  ticks_per_day: 12
  num_days: 1
  rng_seed: 42

# Castro alignment features
deferred_crediting: true      # Credits applied at end of tick (Castro-compatible)
deadline_cap_at_eod: true     # All deadlines capped at day end

# Castro cost structure (see paper Section 6.2):
#   r_c = 0.1 (collateral opportunity cost, PER DAY - charged across all ticks)
#   r_d = 0.2 (delay cost, PER PERIOD - charged each tick a payment is held)
#   r_b = 0.4 (EOD borrowing cost, PER DAY - charged once at day end)
#
# CRITICAL: r_d is per-period, NOT per-day! Each tick a payment is held incurs
# 20% of its value as delay cost. This makes delay expensive to incentivize
# early payment.
cost_rates:
  # r_c: Collateral opportunity cost = 0.1/day
  # Divided across ticks: 0.1/12 = 0.00833 = 83 bps per tick
  collateral_cost_per_tick_bps: 83

  # r_d: Delay cost = 0.2 PER PERIOD (per tick)
  # NOT divided by ticks - each period of delay costs 20% of payment value
  delay_cost_per_tick_per_cent: 0.2

  # r_b: EOD borrowing = 0.4/day
  # Modeled as overdraft cost; divided by ticks: 0.4/12 = 0.0333 = 333 bps per tick
  # Note: Castro applies r_b once at EOD; SimCash charges per-tick while in overdraft
  overdraft_bps_per_tick: 333

  # Castro-equivalent: NO hard penalties (rate-based costs only)
  eod_penalty_per_transaction: 0
  deadline_penalty: 0
  split_friction_cost: 0
  overdue_delay_multiplier: 1.0

# Disable LSM (not in Castro model)
lsm_config:
  enable_bilateral: false
  enable_cycles: false
  max_cycle_length: 3
  max_cycles_per_tick: 1

agents:
  - id: BANK_A
    opening_balance: 0
    # CASTRO-EQUIVALENT: Effectively unlimited credit
    unsecured_cap: 10000000000  # $100M (very high)
    # NOTE: max_collateral_capacity = 10 x unsecured_cap = $1B (computed)
    # Policy fractions should account for this
    policy:
      type: FromJson
      json_path: "experiments/castro/policies/seed_policy.json"
    arrival_config:
      rate_per_tick: 0.5
      amount_distribution:
        type: LogNormal
        mean: 11.51  # ~$100k median
        std_dev: 0.9
      counterparty_weights:
        BANK_B: 1.0
      deadline_range: [3, 8]  # Will be capped at day end by deadline_cap_at_eod
      priority: 5
      divisible: false

  - id: BANK_B
    opening_balance: 0
    unsecured_cap: 10000000000  # $100M
    policy:
      type: FromJson
      json_path: "experiments/castro/policies/seed_policy.json"
    arrival_config:
      rate_per_tick: 0.65
      amount_distribution:
        type: LogNormal
        mean: 11.8  # ~$120k median
        std_dev: 1.0
      counterparty_weights:
        BANK_A: 1.0
      deadline_range: [2, 6]  # Will be capped at day end by deadline_cap_at_eod
      priority: 5
      divisible: false
