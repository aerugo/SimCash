# Castro et al. (2025) - 2-Period Fixed Payment Scenario (CASTRO-ALIGNED)
# Replicates Section 6.3 for analytical validation
#
# CASTRO ALIGNMENT FEATURES ENABLED:
#   - deferred_crediting: true  (credits applied at end of tick)
#   - deadline_cap_at_eod: true (all deadlines capped at day end)
#   - LSM disabled (RTGS without netting, as per Castro model)
#
# CASTRO POLICY CONSTRAINTS (enforced by castro_mode=True in experiment script):
#   - Initial liquidity decision at t=0 ONLY (no mid-day collateral changes)
#   - Payment actions: Only Release (x_t=1) or Hold (x_t=0), no Split
#   - No ReleaseWithCredit (no interbank credit lines in Castro model)
#   - No reactive collateral tree (end_of_tick_collateral_tree)
#
# Payment profiles (in cents):
#   Bank A: P^A = [0, 15000] - No period 1 outgoing, $150 in period 2
#   Bank B: P^B = [15000, 5000] - $150 in period 1, $50 in period 2
#
# Expected Nash Equilibrium (with deferred crediting):
#   Bank A: l_0 = 0 (wait for incoming from B, available in period 2)
#   Bank B: l_0 = 20000 (cover both periods, since A can't recycle in period 1)
#   Costs: R_A = 0, R_B = 2000 (0.1 * 20000)
#
# Key difference from old experiments:
#   With deferred crediting, Bank A cannot use B's period-1 payment until period 2.
#   This should force the ASYMMETRIC equilibrium predicted by Castro.

simulation:
  ticks_per_day: 2
  num_days: 1
  rng_seed: 42

# Castro alignment features
deferred_crediting: true      # Credits applied at end of tick (Castro-compatible)
deadline_cap_at_eod: true     # All deadlines capped at day end

# Castro cost structure: r_c = 0.1, r_d = 0.2, r_b = 0.4 (per day, so per-tick for T=2)
cost_rates:
  # Collateral/liquidity opportunity cost: 10% per tick (since T=2)
  # Castro's r_c = 0.1/day = 5% per tick for 2-period day
  collateral_cost_per_tick_bps: 500

  # Delay cost: 20% of held value per day = 10% per tick for 2-period day
  delay_cost_per_tick_per_cent: 0.001

  # EOD/borrowing penalty: 40% of unsettled per day = 20% per tick
  overdraft_bps_per_tick: 2000

  # Disable non-Castro features
  eod_penalty_per_transaction: 0
  deadline_penalty: 0
  split_friction_cost: 0
  overdue_delay_multiplier: 1.0

# Disable LSM (not in Castro model)
lsm_config:
  enable_bilateral: false
  enable_cycles: false
  max_cycle_length: 3
  max_cycles_per_tick: 1

agents:
  - id: BANK_A
    opening_balance: 0
    unsecured_cap: 50000                   # Allow some credit for flexibility
    max_collateral_capacity: 10000000      # $100k max collateral
    policy:
      type: FromJson
      json_path: "experiments/castro/policies/seed_policy.json"

  - id: BANK_B
    opening_balance: 0
    unsecured_cap: 50000
    max_collateral_capacity: 10000000
    policy:
      type: FromJson
      json_path: "experiments/castro/policies/seed_policy.json"

# Deterministic payment injections matching Castro's profile
scenario_events:
  # Bank A: $150 outgoing in period 2 (tick 1)
  - type: CustomTransactionArrival
    from_agent: BANK_A
    to_agent: BANK_B
    amount: 15000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1

  # Bank B: $150 outgoing in period 1 (tick 0)
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 15000
    priority: 5
    deadline: 1
    schedule:
      type: OneTime
      tick: 0

  # Bank B: $50 outgoing in period 2 (tick 1)
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 5000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1
