============================= test session starts ==============================
platform linux -- Python 3.11.14, pytest-8.4.2, pluggy-1.6.0 -- /home/user/SimCash/api/.venv/bin/python
cachedir: .pytest_cache
rootdir: /home/user/SimCash/api
configfile: pyproject.toml
plugins: anyio-4.11.0, asyncio-1.2.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 811 items

tests/cli/test_checkpoint_cli.py::test_checkpoint_save_command_displays_help PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_save_requires_simulation_id PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_save_creates_checkpoint PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_load_command_displays_help PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_load_requires_checkpoint_id PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_load_requires_config_file PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_load_restores_simulation PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_list_command_displays_help PASSED [  0%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_list_shows_empty_message PASSED [  1%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_list_displays_checkpoints PASSED [  1%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_list_filters_by_simulation PASSED [  1%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_delete_command_displays_help PASSED [  1%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_delete_removes_checkpoint PASSED [  1%]
tests/cli/test_checkpoint_cli.py::test_checkpoint_workflow_save_list_load PASSED [  1%]
tests/cli/test_performance_output.py::test_log_performance_diagnostics_structure PASSED [  1%]
tests/cli/test_performance_output.py::test_log_performance_diagnostics_handles_zero_total PASSED [  1%]
tests/cli/test_performance_output.py::test_log_performance_diagnostics_percentages PASSED [  2%]
tests/cli/test_performance_output.py::test_log_performance_diagnostics_large_values PASSED [  2%]
tests/cli/test_run_command.py::TestModeDeterminism::test_normal_and_verbose_with_persistence_produce_identical_results PASSED [  2%]
tests/cli/test_run_command.py::TestModeDeterminism::test_stream_produces_identical_tick_count PASSED [  2%]
tests/cli/test_run_command.py::TestPersistenceInAllModes::test_normal_mode_persistence PASSED [  2%]
tests/cli/test_run_command.py::TestPersistenceInAllModes::test_verbose_mode_persistence PASSED [  2%]
tests/cli/test_run_command.py::TestPersistenceInAllModes::test_stream_mode_persistence PASSED [  2%]
tests/cli/test_run_command.py::TestPersistenceInAllModes::test_all_modes_persist_identical_data PASSED [  2%]
tests/cli/test_run_command.py::TestModeSpecificOutput::test_normal_mode_outputs_final_json PASSED [  3%]
tests/cli/test_run_command.py::TestModeSpecificOutput::test_verbose_mode_completes_successfully PASSED [  3%]
tests/cli/test_run_command.py::TestModeSpecificOutput::test_stream_mode_outputs_jsonl PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_event_stream_mode_persists_simulation_metadata PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_event_stream_mode_persists_eod_data PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_full_replay_mode_captures_tick_data PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_all_modes_persist_policy_snapshots_at_init PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_all_modes_detect_eod_at_correct_ticks PASSED [  3%]
tests/cli/test_run_command.py::TestCharacterizationForRefactoring::test_event_stream_mode_with_filters_works PASSED [  4%]
tests/e2e/test_checkpoint_api.py::test_save_checkpoint_endpoint PASSED   [  4%]
tests/e2e/test_checkpoint_api.py::test_save_checkpoint_validates_type PASSED [  4%]
tests/e2e/test_checkpoint_api.py::test_save_checkpoint_simulation_not_found PASSED [  4%]
tests/e2e/test_checkpoint_api.py::test_load_checkpoint_endpoint PASSED   [  4%]
tests/e2e/test_checkpoint_api.py::test_load_checkpoint_not_found PASSED  [  4%]
tests/e2e/test_checkpoint_api.py::test_list_checkpoints_endpoint PASSED  [  4%]
tests/e2e/test_checkpoint_api.py::test_list_checkpoints_empty PASSED     [  4%]
tests/e2e/test_checkpoint_api.py::test_list_checkpoints_simulation_not_found PASSED [  5%]
tests/e2e/test_checkpoint_api.py::test_restored_simulation_continues_correctly PASSED [  5%]
tests/e2e/test_checkpoint_api.py::test_get_checkpoint_details PASSED     [  5%]
tests/e2e/test_checkpoint_api.py::test_get_checkpoint_not_found PASSED   [  5%]
tests/e2e/test_checkpoint_api.py::test_delete_checkpoint PASSED          [  5%]
tests/e2e/test_checkpoint_api.py::test_delete_checkpoint_idempotent PASSED [  5%]
tests/e2e/test_checkpoint_integration.py::test_complete_checkpoint_workflow PASSED [  5%]
tests/e2e/test_checkpoint_integration.py::test_multiple_checkpoints_same_simulation PASSED [  5%]
tests/e2e/test_checkpoint_integration.py::test_restore_from_multiple_checkpoints PASSED [  6%]
tests/e2e/test_checkpoint_integration.py::test_checkpoint_performance PASSED [  6%]
tests/e2e/test_checkpoint_integration.py::test_restore_nonexistent_checkpoint PASSED [  6%]
tests/e2e/test_checkpoint_integration.py::test_checkpoint_nonexistent_simulation PASSED [  6%]
tests/e2e/test_checkpoint_integration.py::test_large_scale_checkpoint XPASS [  6%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_simulation_metadata_endpoint SKIPPED [  6%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_agent_list_endpoint SKIPPED [  6%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_transactions_endpoint_with_database SKIPPED [  6%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_events_endpoint SKIPPED [  7%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_simulation_list_endpoint SKIPPED [  7%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_daily_metrics_data SKIPPED [  7%]
tests/e2e/test_diagnostic_dashboard_e2e.py::test_transaction_data_quality SKIPPED [  7%]
tests/ffi/test_checkpoint.py::test_save_state_returns_valid_json PASSED  [  7%]
tests/ffi/test_checkpoint.py::test_save_state_includes_required_fields PASSED [  7%]
tests/ffi/test_checkpoint.py::test_save_state_captures_tick_progress PASSED [  7%]
tests/ffi/test_checkpoint.py::test_load_state_restores_orchestrator PASSED [  7%]
tests/ffi/test_checkpoint.py::test_load_state_rejects_config_mismatch PASSED [  8%]
tests/ffi/test_checkpoint.py::test_load_state_rejects_corrupted_json PASSED [  8%]
tests/ffi/test_checkpoint.py::test_determinism_after_restore PASSED      [  8%]
tests/ffi/test_checkpoint.py::test_save_load_roundtrip_preserves_exact_state PASSED [  8%]
tests/ffi/test_checkpoint.py::test_balance_conservation_preserved PASSED [  8%]
tests/ffi/test_checkpoint.py::test_get_checkpoint_info_returns_metadata PASSED [  8%]
tests/ffi/test_checkpoint.py::test_get_checkpoint_info_handles_invalid_json PASSED [  8%]
tests/ffi/test_determinism.py::test_same_seed_same_results PASSED        [  8%]
tests/ffi/test_determinism.py::test_different_seed_different_results PASSED [  9%]
tests/ffi/test_orchestrator_creation.py::test_create_minimal_orchestrator PASSED [  9%]
tests/ffi/test_orchestrator_creation.py::test_invalid_config_raises_error PASSED [  9%]
tests/ffi/test_orchestrator_creation.py::test_type_conversion PASSED     [  9%]
tests/ffi/test_state_queries.py::test_get_agent_balance PASSED           [  9%]
tests/ffi/test_state_queries.py::test_get_queue1_size PASSED             [  9%]
tests/ffi/test_state_queries.py::test_get_queue2_size PASSED             [  9%]
tests/ffi/test_state_queries.py::test_get_agent_ids PASSED               [  9%]
tests/ffi/test_state_queries.py::test_query_methods_during_simulation PASSED [  9%]
tests/ffi/test_state_queries.py::test_iterate_all_agents PASSED          [ 10%]
tests/ffi/test_tick_execution.py::test_tick_returns_result PASSED        [ 10%]
tests/ffi/test_tick_execution.py::test_multiple_ticks PASSED             [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_simple_transaction PASSED [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_settles PASSED [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_invalid_sender PASSED [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_invalid_receiver PASSED [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_invalid_amount PASSED [ 10%]
tests/ffi/test_transaction_submission.py::test_submit_multiple_transactions PASSED [ 11%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_with_insufficient_funds PASSED [ 11%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_priority_levels PASSED [ 11%]
tests/ffi/test_transaction_submission.py::test_submit_divisible_transaction PASSED [ 11%]
tests/ffi/test_transaction_submission.py::test_submit_transaction_deadline_in_past PASSED [ 11%]
tests/ffi/test_transaction_submission.py::test_transaction_ids_are_unique PASSED [ 11%]
tests/integration/test_agent_arrival_rate_change.py::test_agent_arrival_rate_change_doubles_rate PASSED [ 11%]
tests/integration/test_agent_arrival_rate_change.py::test_agent_arrival_rate_change_halves_rate PASSED [ 11%]
tests/integration/test_agent_arrival_rate_change.py::test_agent_arrival_rate_change_near_halt PASSED [ 12%]
tests/integration/test_agent_arrival_rate_change.py::test_agent_arrival_rate_change_logged_to_events PASSED [ 12%]
tests/integration/test_agent_arrival_rate_change.py::test_multiple_agent_arrival_rate_changes PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestFFIAgentMetricsRetrieval::test_get_daily_agent_metrics_returns_list PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestFFIAgentMetricsRetrieval::test_get_daily_agent_metrics_returns_dicts_with_required_fields PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestFFIAgentMetricsRetrieval::test_agent_metrics_validate_with_pydantic_model PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestFFIAgentMetricsRetrieval::test_metrics_filter_by_day PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestBalanceMetricsTracking::test_metrics_track_opening_and_closing_balance PASSED [ 12%]
tests/integration/test_agent_metrics.py::TestBalanceMetricsTracking::test_metrics_track_min_and_max_balance PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestBalanceMetricsTracking::test_metrics_track_peak_overdraft PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestTransactionCountMetrics::test_metrics_track_transaction_counts PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestQueueMetrics::test_metrics_track_queue1_peak_and_eod_size PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestCostMetrics::test_metrics_include_all_cost_categories PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestPolarsDataFrameConversion::test_create_polars_dataframe_from_metrics PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestDuckDBBatchWrite::test_insert_agent_metrics_to_duckdb PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestDuckDBBatchWrite::test_batch_write_performance_1000_agent_days PASSED [ 13%]
tests/integration/test_agent_metrics.py::TestEndToEndAgentMetricsPersistence::test_full_simulation_with_agent_metrics_persistence PASSED [ 14%]
tests/integration/test_agent_metrics.py::TestEndToEndAgentMetricsPersistence::test_multi_day_metrics_accumulation PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestFFIAgentMetricsRetrieval::test_get_daily_agent_metrics_returns_list PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestFFIAgentMetricsRetrieval::test_get_daily_agent_metrics_returns_dicts_with_required_fields PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestFFIAgentMetricsRetrieval::test_metrics_track_balance_changes PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestPolarsAgentMetricsConversion::test_create_polars_dataframe_from_metrics PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestPolarsAgentMetricsConversion::test_dataframe_matches_pydantic_model PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestDuckDBAgentMetricsBatchWrite::test_insert_agent_metrics_to_duckdb PASSED [ 14%]
tests/integration/test_agent_metrics_persistence.py::TestDuckDBAgentMetricsBatchWrite::test_batch_write_performance_multiple_days PASSED [ 15%]
tests/integration/test_agent_metrics_persistence.py::TestEndToEndAgentMetricsPersistence::test_full_simulation_with_agent_metrics_persistence PASSED [ 15%]
tests/integration/test_agent_metrics_persistence.py::TestEndToEndAgentMetricsPersistence::test_collateral_fields_are_persisted PASSED [ 15%]
tests/integration/test_api_simulations.py::test_create_simulation PASSED [ 15%]
tests/integration/test_api_simulations.py::test_create_simulation_with_invalid_config PASSED [ 15%]
tests/integration/test_api_simulations.py::test_get_simulation_state PASSED [ 15%]
tests/integration/test_api_simulations.py::test_get_nonexistent_simulation PASSED [ 15%]
tests/integration/test_api_simulations.py::test_tick_simulation PASSED   [ 15%]
tests/integration/test_api_simulations.py::test_tick_multiple_times PASSED [ 16%]
tests/integration/test_api_simulations.py::test_tick_with_count_parameter PASSED [ 16%]
tests/integration/test_api_simulations.py::test_delete_simulation PASSED [ 16%]
tests/integration/test_api_simulations.py::test_list_simulations PASSED  [ 16%]
tests/integration/test_api_simulations.py::test_simulation_with_arrivals PASSED [ 16%]
tests/integration/test_api_simulations.py::test_simulation_state_includes_queues PASSED [ 16%]
tests/integration/test_api_simulations.py::test_concurrent_simulations PASSED [ 16%]
tests/integration/test_api_transactions.py::test_submit_transaction PASSED [ 16%]
tests/integration/test_api_transactions.py::test_submit_transaction_invalid_sender PASSED [ 17%]
tests/integration/test_api_transactions.py::test_submit_transaction_invalid_amount PASSED [ 17%]
tests/integration/test_api_transactions.py::test_get_transaction_status PASSED [ 17%]
tests/integration/test_api_transactions.py::test_transaction_lifecycle PASSED [ 17%]
tests/integration/test_api_transactions.py::test_list_transactions PASSED [ 17%]
tests/integration/test_api_transactions.py::test_transaction_with_insufficient_funds PASSED [ 17%]
tests/integration/test_api_transactions.py::test_nonexistent_transaction PASSED [ 17%]
tests/integration/test_api_transactions.py::test_submit_to_nonexistent_simulation PASSED [ 17%]
tests/integration/test_api_transactions.py::test_transaction_filtering_by_status PASSED [ 18%]
tests/integration/test_api_transactions.py::test_transaction_filtering_by_agent PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_save_checkpoint_creates_record PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_save_checkpoint_stores_state_json PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_save_checkpoint_captures_metadata PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_load_checkpoint_restores_orchestrator PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_load_checkpoint_validates_config_hash PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_load_checkpoint_preserves_determinism PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_list_checkpoints_for_simulation PASSED [ 18%]
tests/integration/test_checkpoint_persistence.py::test_list_checkpoints_ordered_by_time PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_get_latest_checkpoint PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_checkpoint_size_tracking PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_checkpoint_hash_validation PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_delete_checkpoint PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_load_nonexistent_checkpoint_raises_error PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_save_checkpoint_with_empty_simulation_id_raises_error PASSED [ 19%]
tests/integration/test_checkpoint_persistence.py::test_checkpoint_types_are_validated PASSED [ 19%]
tests/integration/test_cli_event_filters.py::TestFilterValidation::test_filter_without_mode_fails SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestFilterValidation::test_filter_with_verbose_succeeds SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestFilterValidation::test_filter_with_event_stream_succeeds SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestEventTypeFiltering::test_filter_single_event_type_verbose SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestEventTypeFiltering::test_filter_single_event_type_stream SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestEventTypeFiltering::test_filter_multiple_event_types SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestAgentFiltering::test_filter_by_agent_verbose SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestAgentFiltering::test_filter_by_agent_stream SKIPPED [ 20%]
tests/integration/test_cli_event_filters.py::TestTickRangeFiltering::test_filter_tick_range_both SKIPPED [ 21%]
tests/integration/test_cli_event_filters.py::TestTickRangeFiltering::test_filter_tick_range_min_only SKIPPED [ 21%]
tests/integration/test_cli_event_filters.py::TestTickRangeFiltering::test_filter_tick_range_max_only SKIPPED [ 21%]
tests/integration/test_cli_event_filters.py::TestMultipleFilters::test_multiple_filters_and_logic SKIPPED [ 21%]
tests/integration/test_cli_event_filters.py::TestMultipleFilters::test_all_filters_combined SKIPPED [ 21%]
tests/integration/test_collateral_event_persistence.py::TestFFICollateralEventRetrieval::test_ffi_get_collateral_events_for_day_exists PASSED [ 21%]
tests/integration/test_collateral_event_persistence.py::TestFFICollateralEventRetrieval::test_collateral_event_has_required_fields PASSED [ 21%]
tests/integration/test_collateral_event_persistence.py::TestFFICollateralEventRetrieval::test_collateral_events_validate_with_pydantic PASSED [ 21%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventPersistence::test_collateral_events_persisted_to_database SKIPPED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventPersistence::test_collateral_events_match_metrics_counts PASSED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventPersistence::test_collateral_events_capture_strategic_and_eod_layers PASSED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventSchema::test_collateral_events_table_exists PASSED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventSchema::test_collateral_events_table_has_required_columns PASSED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventDataIntegrity::test_collateral_action_values_valid PASSED [ 22%]
tests/integration/test_collateral_event_persistence.py::TestCollateralEventDataIntegrity::test_collateral_layer_values_valid PASSED [ 22%]
tests/integration/test_collateral_headroom.py::test_posted_collateral_increases_available_liquidity PASSED [ 22%]
tests/integration/test_collateral_headroom.py::test_collateral_enables_settlement_of_queued_transactions PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_collateral_minimum_holding_period_prevents_immediate_withdrawal PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_collateral_policy_hysteresis_posting_threshold PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_collateral_policy_hysteresis_withdrawal_threshold PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_no_collateral_oscillation_under_sustained_pressure PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_collateral_events_have_specific_reasons_not_vague PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_collateral_withdrawal_reason_is_specific PASSED [ 23%]
tests/integration/test_collateral_headroom.py::test_available_liquidity_calculation_includes_collateral PASSED [ 23%]
tests/integration/test_config_json_persistence.py::test_persist_simulation_stores_config_json PASSED [ 24%]
tests/integration/test_config_json_persistence.py::test_config_json_handles_large_configs PASSED [ 24%]
tests/integration/test_config_json_persistence.py::test_backwards_compatibility_without_config_json PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_endpoint_exists PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_returns_required_fields PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_simulation_id_matches PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_agents_is_dict PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_all_agents_present PASSED [ 24%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_agent_breakdown_has_all_cost_types PASSED [ 25%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_all_values_are_integers PASSED [ 25%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_total_system_cost_equals_sum PASSED [ 25%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_after_running_ticks PASSED [ 25%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_404_for_nonexistent_simulation PASSED [ 25%]
tests/integration/test_cost_api.py::TestCostsEndpoint::test_get_costs_tick_and_day_match_simulation_state PASSED [ 25%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_endpoint_exists PASSED [ 25%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_returns_required_fields PASSED [ 25%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_simulation_id_matches PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_contains_all_metric_fields PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_settlement_rate_is_float PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_avg_delay_is_float PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_counts_are_integers PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_settlements_le_arrivals PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_after_running_ticks PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_404_for_nonexistent_simulation PASSED [ 26%]
tests/integration/test_cost_api.py::TestMetricsEndpoint::test_get_metrics_tick_and_day_match_simulation_state PASSED [ 27%]
tests/integration/test_cost_api.py::TestEndpointIntegration::test_costs_and_metrics_both_available PASSED [ 27%]
tests/integration/test_cost_api.py::TestEndpointIntegration::test_costs_increase_over_time PASSED [ 27%]
tests/integration/test_cost_api.py::TestEndpointIntegration::test_metrics_update_after_ticks PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_returns_all_cost_types PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_returns_integers PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_non_negative PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_total_is_sum PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_for_all_agents PASSED [ 27%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_get_agent_accumulated_costs_nonexistent_agent_raises_error PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestAgentCostFFI::test_cost_accumulation_over_ticks PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_returns_expected_fields PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_settlement_rate_valid_range PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_counts_non_negative PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_settlements_le_arrivals PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_settlement_rate_calculation PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_types PASSED [ 28%]
tests/integration/test_cost_ffi.py::TestSystemMetricsFFI::test_get_system_metrics_zero_state PASSED [ 29%]
tests/integration/test_cost_ffi.py::TestFFIDeterminism::test_cost_queries_deterministic_across_runs PASSED [ 29%]
tests/integration/test_cost_ffi.py::TestFFIDeterminism::test_metrics_queries_deterministic_across_runs PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_counterparty_weight_change_basic PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_counterparty_weight_change_zero_weight PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_counterparty_weight_change_logged_to_events PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_multiple_counterparty_weight_changes PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_counterparty_weight_change_new_counterparty PASSED [ 29%]
tests/integration/test_counterparty_weight_change.py::test_counterparty_weight_change_isolated PASSED [ 30%]
tests/integration/test_custom_transaction_arrival.py::test_custom_transaction_arrival_creates_pending_transaction PASSED [ 30%]
tests/integration/test_custom_transaction_arrival.py::test_custom_transaction_arrival_with_defaults PASSED [ 30%]
tests/integration/test_custom_transaction_arrival.py::test_custom_transaction_arrival_repeating PASSED [ 30%]
tests/integration/test_custom_transaction_arrival.py::test_custom_transaction_arrival_vs_direct_transfer PASSED [ 30%]
tests/integration/test_custom_transaction_arrival.py::test_custom_transaction_arrival_logged_to_events PASSED [ 30%]
tests/integration/test_deadline_window_change.py::test_deadline_window_change_doubles_all_ranges PASSED [ 30%]
tests/integration/test_deadline_window_change.py::test_deadline_window_change_halves_max_only PASSED [ 30%]
tests/integration/test_deadline_window_change.py::test_deadline_window_change_tighten_urgency PASSED [ 31%]
tests/integration/test_deadline_window_change.py::test_deadline_window_change_logged_to_events PASSED [ 31%]
tests/integration/test_deadline_window_change.py::test_multiple_deadline_window_changes PASSED [ 31%]
tests/integration/test_deadline_window_change.py::test_deadline_window_change_min_multiplier_only PASSED [ 31%]
tests/integration/test_determinism_gold_standard.py::test_determinism_five_consecutive_runs_simple PASSED [ 31%]
tests/integration/test_determinism_gold_standard.py::test_determinism_comprehensive_showcase_config PASSED [ 31%]
tests/integration/test_determinism_gold_standard.py::test_determinism_tick_by_tick PASSED [ 31%]
tests/integration/test_determinism_gold_standard.py::test_determinism_different_seeds_produce_different_results PASSED [ 31%]
tests/integration/test_diagnostic_api_config_json.py::test_get_simulation_metadata_with_config_json PASSED [ 32%]
tests/integration/test_diagnostic_api_config_json.py::test_get_simulation_metadata_without_config_json_fallback PASSED [ 32%]
tests/integration/test_diagnostic_api_config_json.py::test_get_simulation_metadata_with_12_bank_config PASSED [ 32%]
tests/integration/test_diagnostic_api_config_json.py::test_get_agent_list_from_database PASSED [ 32%]
tests/integration/test_diagnostic_endpoints.py::test_list_simulations_includes_active PASSED [ 32%]
tests/integration/test_diagnostic_endpoints.py::test_list_simulations_includes_database PASSED [ 32%]
tests/integration/test_diagnostic_endpoints.py::test_get_simulation_metadata PASSED [ 32%]
tests/integration/test_diagnostic_endpoints.py::test_get_simulation_metadata_not_found PASSED [ 32%]
tests/integration/test_diagnostic_endpoints.py::test_get_simulation_metadata_from_database PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_agent_list PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_agent_list_not_found PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_events_paginated PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_events_filtered_by_agent PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_events_with_tick_range PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_agent_timeline PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_agent_timeline_not_found_simulation PASSED [ 33%]
tests/integration/test_diagnostic_endpoints.py::test_get_agent_timeline_not_found_agent PASSED [ 34%]
tests/integration/test_diagnostic_endpoints.py::test_get_transaction_lifecycle PASSED [ 34%]
tests/integration/test_diagnostic_endpoints.py::test_get_transaction_lifecycle_not_found PASSED [ 34%]
tests/integration/test_diagnostic_transactions.py::test_get_transactions_from_database PASSED [ 34%]
tests/integration/test_diagnostic_transactions.py::test_get_transactions_with_filters PASSED [ 34%]
tests/integration/test_diagnostic_transactions.py::test_get_transaction_lifecycle PASSED [ 34%]
tests/integration/test_diagnostic_transactions.py::test_empty_transactions_returns_404 PASSED [ 34%]
tests/integration/test_diagnostic_transactions.py::test_simulation_with_zero_transactions PASSED [ 34%]
tests/integration/test_event_persistence.py::TestSimulationEventsTableSchema::test_simulation_events_table_exists PASSED [ 35%]
tests/integration/test_event_persistence.py::TestSimulationEventsTableSchema::test_simulation_events_table_has_required_columns PASSED [ 35%]
tests/integration/test_event_persistence.py::TestSimulationEventsTableSchema::test_simulation_events_table_has_indexes PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventPersistenceDuringSimulation::test_events_persisted_after_simulation PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventPersistenceDuringSimulation::test_arrival_events_persisted PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventPersistenceDuringSimulation::test_events_have_required_fields PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventQueryFunctions::test_query_events_by_tick PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventQueryFunctions::test_query_events_by_agent_id PASSED [ 35%]
tests/integration/test_event_persistence.py::TestEventQueryFunctions::test_query_events_by_event_type PASSED [ 36%]
tests/integration/test_event_persistence.py::TestEventQueryFunctions::test_query_events_with_pagination PASSED [ 36%]
tests/integration/test_event_persistence.py::TestEventPersistencePerformance::test_event_persistence_overhead PASSED [ 36%]
tests/integration/test_event_persistence.py::TestEventDataIntegrity::test_event_count_matches_rust_event_log PASSED [ 36%]
tests/integration/test_event_persistence.py::TestEventDataIntegrity::test_event_ordering_preserved PASSED [ 36%]
tests/integration/test_event_persistence.py::TestEventDataIntegrity::test_no_duplicate_events PASSED [ 36%]
tests/integration/test_event_timeline_api.py::TestBasicEventRetrieval::test_get_events_basic PASSED [ 36%]
tests/integration/test_event_timeline_api.py::TestBasicEventRetrieval::test_get_events_returns_event_structure PASSED [ 36%]
tests/integration/test_event_timeline_api.py::TestTickFiltering::test_filter_by_exact_tick PASSED [ 36%]
tests/integration/test_event_timeline_api.py::TestTickFiltering::test_filter_by_tick_range PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestTickFiltering::test_filter_by_tick_min_only PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestTickFiltering::test_filter_by_tick_max_only PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestAgentFiltering::test_filter_by_agent_id PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestEventTypeFiltering::test_filter_by_single_event_type PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestEventTypeFiltering::test_filter_by_multiple_event_types PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestTransactionFiltering::test_filter_by_tx_id PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestDayFiltering::test_filter_by_day PASSED [ 37%]
tests/integration/test_event_timeline_api.py::TestPagination::test_pagination_with_limit PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestPagination::test_pagination_with_offset PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestPagination::test_pagination_respects_max_limit PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestSorting::test_sort_tick_ascending PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestSorting::test_sort_tick_descending PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestErrorHandling::test_simulation_not_found PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestErrorHandling::test_invalid_tick_range PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestErrorHandling::test_invalid_sort_parameter PASSED [ 38%]
tests/integration/test_event_timeline_api.py::TestCombinedFilters::test_tick_range_and_agent PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_global_arrival_rate_change_doubles_all_rates PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_global_arrival_rate_change_halves_all_rates PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_global_arrival_rate_change_near_halt_all PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_global_arrival_rate_change_logged_to_events PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_multiple_global_arrival_rate_changes PASSED [ 39%]
tests/integration/test_global_arrival_rate_change.py::test_global_arrival_rate_change_affects_all_agents PASSED [ 39%]
tests/integration/test_lsm_activation.py::test_lsm_bilateral_offset_via_orchestrator PASSED [ 39%]
tests/integration/test_lsm_activation.py::test_lsm_cycle_settlement_via_orchestrator PASSED [ 40%]
tests/integration/test_lsm_activation.py::test_lsm_combined_bilateral_and_cycles PASSED [ 40%]
tests/integration/test_lsm_activation.py::test_lsm_does_not_activate_with_sufficient_liquidity PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestFFILsmCycleRetrieval::test_ffi_get_lsm_cycles_for_day_exists PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestFFILsmCycleRetrieval::test_ffi_get_lsm_cycles_returns_list PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestFFILsmCycleRetrieval::test_lsm_cycle_has_required_fields PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCyclePersistence::test_lsm_cycles_table_schema PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCyclePersistence::test_lsm_cycles_persisted PASSED [ 40%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCyclePersistence::test_bilateral_vs_multilateral PASSED [ 41%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCyclePersistence::test_cycle_values_accurate PASSED [ 41%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCyclePersistence::test_multiple_cycles_per_day PASSED [ 41%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCycleDataIntegrity::test_agents_array_valid_json PASSED [ 41%]
tests/integration/test_lsm_cycle_persistence.py::TestLsmCycleDataIntegrity::test_transaction_ids_in_cycle_exist PASSED [ 41%]
tests/integration/test_lsm_event_completeness.py::TestLsmEventCompleteness::test_lsm_bilateral_offset_event_has_required_fields SKIPPED [ 41%]
tests/integration/test_lsm_event_logging.py::TestLsmEventLogging::test_lsm_bilateral_offset_events_are_logged PASSED [ 41%]
tests/integration/test_lsm_event_logging.py::TestLsmEventLogging::test_lsm_events_are_persisted_to_database PASSED [ 41%]
tests/integration/test_lsm_event_logging.py::TestLsmEventLogging::test_lsm_multilateral_cycle_events_are_logged PASSED [ 42%]
tests/integration/test_lsm_metric_fix.py::test_lsm_releases_should_not_exceed_total_arrivals PASSED [ 42%]
tests/integration/test_new_runner_integration.py::TestNewRunnerVerboseMode::test_verbose_mode_output_strategy_completes_successfully PASSED [ 42%]
tests/integration/test_new_runner_integration.py::TestNewRunnerVerboseMode::test_verbose_mode_with_persistence_via_new_runner PASSED [ 42%]
tests/integration/test_new_runner_integration.py::TestNewRunnerNormalMode::test_normal_mode_output_strategy_produces_json PASSED [ 42%]
tests/integration/test_new_runner_integration.py::TestFactoryFunction::test_create_output_strategy_for_verbose_mode PASSED [ 42%]
tests/integration/test_new_runner_integration.py::TestFactoryFunction::test_create_output_strategy_for_normal_mode PASSED [ 42%]
tests/integration/test_overdue_debug.py::test_debug_transaction_state PASSED [ 42%]
tests/integration/test_overdue_ffi_methods.py::test_get_transactions_near_deadline_empty PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_transactions_near_deadline_with_transactions PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_transactions_near_deadline_excludes_settled PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_transactions_near_deadline_excludes_overdue PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_overdue_transactions_empty PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_overdue_transactions_with_overdue_tx PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_get_overdue_transactions_accumulates_delay_cost PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_transaction_went_overdue_event_emitted PASSED [ 43%]
tests/integration/test_overdue_ffi_methods.py::test_overdue_transaction_settled_event_emitted PASSED [ 44%]
tests/integration/test_overdue_replay_identity.py::test_transaction_went_overdue_event_persists_all_fields PASSED [ 44%]
tests/integration/test_overdue_replay_identity.py::test_overdue_transaction_settled_event_persists_all_fields SKIPPED [ 44%]
tests/integration/test_overdue_replay_identity.py::test_overdue_events_count_matches_live_and_replay PASSED [ 44%]
tests/integration/test_overdue_transactions.py::test_transaction_becomes_overdue_after_deadline PASSED [ 44%]
tests/integration/test_overdue_transactions.py::test_overdue_transaction_eventually_settles PASSED [ 44%]
tests/integration/test_overdue_transactions.py::test_overdue_delay_cost_multiplier_applied PASSED [ 44%]
tests/integration/test_overdue_transactions.py::test_deadline_penalty_charged_once PASSED [ 44%]
tests/integration/test_overdue_transactions.py::test_multiple_overdue_transactions PASSED [ 45%]
tests/integration/test_overdue_transactions.py::test_config_with_overdue_multiplier PASSED [ 45%]
tests/integration/test_overdue_transactions.py::test_config_uses_default_multiplier_when_not_specified PASSED [ 45%]
tests/integration/test_overdue_verbose_e2e.py::test_overdue_display_functions PASSED [ 45%]
tests/integration/test_performance_diagnostics.py::test_tick_result_includes_timing_data PASSED [ 45%]
tests/integration/test_performance_diagnostics.py::test_timing_values_are_reasonable PASSED [ 45%]
tests/integration/test_performance_diagnostics.py::test_timing_consistency_across_ticks PASSED [ 45%]
tests/integration/test_phase1_api_enhancements.py::test_get_agent_queues_returns_queue_contents PASSED [ 45%]
tests/integration/test_phase1_api_enhancements.py::test_get_agent_queues_404_for_nonexistent_simulation PASSED [ 45%]
tests/integration/test_phase1_api_enhancements.py::test_get_agent_queues_404_for_nonexistent_agent PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_get_agent_queues_calculates_total_value_correctly PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_get_near_deadline_transactions_with_default_window PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_get_near_deadline_transactions_with_custom_window PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_near_deadline_transactions_have_correct_fields PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_near_deadline_transactions_excludes_settled PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_near_deadline_404_for_nonexistent_simulation PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_get_overdue_transactions_structure PASSED [ 46%]
tests/integration/test_phase1_api_enhancements.py::test_overdue_transactions_have_cost_information PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_overdue_transactions_excludes_settled PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_overdue_404_for_nonexistent_simulation PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_get_tick_state_snapshot_structure PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_tick_state_includes_agent_details PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_tick_state_includes_system_metrics PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_tick_state_404_for_nonexistent_simulation PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_tick_state_400_for_invalid_tick PASSED [ 47%]
tests/integration/test_phase1_api_enhancements.py::test_agent_queues_not_supported_for_database_simulations PASSED [ 48%]
tests/integration/test_phase1_api_enhancements.py::test_near_deadline_works_with_database_simulations PASSED [ 48%]
tests/integration/test_phase1_api_enhancements.py::test_overdue_works_with_database_simulations PASSED [ 48%]
tests/integration/test_phase1_api_enhancements.py::test_tick_state_works_with_database_simulations PASSED [ 48%]
tests/integration/test_policy_snapshot_persistence.py::TestFFIPolicyRetrieval::test_get_agent_policies_returns_list PASSED [ 48%]
tests/integration/test_policy_snapshot_persistence.py::TestFFIPolicyRetrieval::test_get_agent_policies_returns_dicts_with_required_fields PASSED [ 48%]
tests/integration/test_policy_snapshot_persistence.py::TestFFIPolicyRetrieval::test_policy_config_matches_input PASSED [ 48%]
tests/integration/test_policy_snapshot_persistence.py::TestPolicySnapshotHashCreation::test_create_policy_hash_from_json PASSED [ 48%]
tests/integration/test_policy_snapshot_persistence.py::TestPolicySnapshotHashCreation::test_same_policy_produces_same_hash PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestPolicySnapshotHashCreation::test_different_policies_produce_different_hashes PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestPolicySnapshotHashCreation::test_policy_field_order_does_not_affect_hash PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestPolarsPolicySnapshotConversion::test_create_polars_dataframe_from_policy_snapshots PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestPolarsPolicySnapshotConversion::test_dataframe_matches_pydantic_model PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestDuckDBPolicySnapshotBatchWrite::test_insert_policy_snapshots_to_duckdb PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestDuckDBPolicySnapshotBatchWrite::test_batch_write_policy_hash_deduplication PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestEndToEndPolicySnapshotPersistence::test_initial_policy_capture_at_simulation_start PASSED [ 49%]
tests/integration/test_policy_snapshot_persistence.py::TestEndToEndPolicySnapshotPersistence::test_policy_provenance_query PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotModel::test_policy_snapshot_record_validates PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotModel::test_policy_snapshot_record_has_table_config PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicyHashComputation::test_compute_policy_hash_deterministic PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicyHashComputation::test_compute_policy_hash_different_policies PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicyHashComputation::test_compute_policy_hash_normalized PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotCreation::test_create_policy_snapshot_with_hash PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotCreation::test_create_policy_snapshot_same_hash_for_identical_policies PASSED [ 50%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotPersistence::test_write_policy_snapshots_to_duckdb PASSED [ 51%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotPersistence::test_query_policy_snapshots_by_simulation PASSED [ 51%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotIntegration::test_capture_initial_policies_at_simulation_start PASSED [ 51%]
tests/integration/test_policy_snapshots.py::TestPolicySnapshotIntegration::test_policy_snapshot_reconstructs_history PASSED [ 51%]
tests/integration/test_policy_snapshots.py::TestPolicyTemplateLoading::test_load_policy_templates_from_disk PASSED [ 51%]
tests/integration/test_policy_snapshots.py::TestPolicyTemplateLoading::test_database_manager_loads_templates_on_setup PASSED [ 51%]
tests/integration/test_queries.py::TestAgentPerformanceQueries::test_get_agent_performance_returns_dataframe PASSED [ 51%]
tests/integration/test_queries.py::TestAgentPerformanceQueries::test_get_agent_performance_ordered_by_day PASSED [ 51%]
tests/integration/test_queries.py::TestAgentPerformanceQueries::test_get_agent_performance_filters_by_simulation_and_agent PASSED [ 52%]
tests/integration/test_queries.py::TestAgentPerformanceQueries::test_get_agent_performance_empty_for_nonexistent_agent PASSED [ 52%]
tests/integration/test_queries.py::TestTransactionAnalysisQueries::test_get_settlement_rate_by_day PASSED [ 52%]
tests/integration/test_queries.py::TestTransactionAnalysisQueries::test_get_daily_transaction_summary PASSED [ 52%]
tests/integration/test_queries.py::TestTransactionAnalysisQueries::test_get_transaction_delays PASSED [ 52%]
tests/integration/test_queries.py::TestSystemMetricsQueries::test_get_simulation_summary PASSED [ 52%]
tests/integration/test_queries.py::TestSystemMetricsQueries::test_list_simulation_runs PASSED [ 52%]
tests/integration/test_queries.py::TestCostAnalysisQueries::test_get_cost_breakdown_by_agent PASSED [ 52%]
tests/integration/test_queries.py::TestCostAnalysisQueries::test_get_daily_cost_trends PASSED [ 53%]
tests/integration/test_queries.py::TestQueryPerformance::test_agent_performance_query_fast_on_large_dataset PASSED [ 53%]
tests/integration/test_queries.py::TestQueryPerformance::test_settlement_rate_query_fast_on_many_transactions PASSED [ 53%]
tests/integration/test_query_interface.py::TestSimulationListQueries::test_list_all_simulations PASSED [ 53%]
tests/integration/test_query_interface.py::TestSimulationListQueries::test_list_simulations_with_status_filter PASSED [ 53%]
tests/integration/test_query_interface.py::TestSimulationListQueries::test_list_simulations_sorted_by_date PASSED [ 53%]
tests/integration/test_query_interface.py::TestSimulationDetailQueries::test_get_simulation_summary PASSED [ 53%]
tests/integration/test_query_interface.py::TestSimulationDetailQueries::test_get_simulation_summary_not_found PASSED [ 53%]
tests/integration/test_query_interface.py::TestAgentMetricsQueries::test_get_agent_daily_metrics PASSED [ 54%]
tests/integration/test_query_interface.py::TestAgentMetricsQueries::test_get_agent_daily_metrics_with_cost_breakdown PASSED [ 54%]
tests/integration/test_query_interface.py::TestTransactionQueries::test_get_transactions_for_simulation PASSED [ 54%]
tests/integration/test_query_interface.py::TestTransactionQueries::test_get_transactions_with_status_filter PASSED [ 54%]
tests/integration/test_query_interface.py::TestTransactionQueries::test_get_transaction_statistics PASSED [ 54%]
tests/integration/test_query_interface.py::TestPolicyComparisonQueries::test_compare_simulations PASSED [ 54%]
tests/integration/test_query_interface.py::TestPolicyComparisonQueries::test_compare_agent_performance PASSED [ 54%]
tests/integration/test_query_interface.py::TestPolicyProvenanceQueries::test_get_agent_policy_history PASSED [ 54%]
tests/integration/test_query_interface.py::TestPolicyProvenanceQueries::test_get_policy_at_day PASSED [ 54%]
tests/integration/test_query_interface.py::TestPerformanceQueries::test_large_transaction_query_performance PASSED [ 55%]
tests/integration/test_queue1_amounts.py::test_queue1_amounts_are_nonzero SKIPPED [ 55%]
tests/integration/test_queue1_amounts.py::test_queue1_display_amounts_match_sum SKIPPED [ 55%]
tests/integration/test_queue_persistence.py::TestFFIQueueRetrieval::test_ffi_get_agent_queue1_contents_exists PASSED [ 55%]
tests/integration/test_queue_persistence.py::TestFFIQueueRetrieval::test_ffi_get_agent_queue1_contents_returns_list PASSED [ 55%]
tests/integration/test_queue_persistence.py::TestFFIQueueRetrieval::test_ffi_get_agent_queue1_contents_ordering PASSED [ 55%]
tests/integration/test_queue_persistence.py::TestQueuePersistence::test_agent_queue_snapshots_table_schema PASSED [ 55%]
tests/integration/test_queue_persistence.py::TestQueuePersistence::test_agent_queue_snapshots_persisted PASSED [ 55%]
tests/integration/test_queue_persistence.py::TestQueuePersistence::test_queue_snapshots_preserve_order PASSED [ 56%]
tests/integration/test_queue_persistence.py::TestQueuePersistence::test_queue_snapshots_match_queue_size PASSED [ 56%]
tests/integration/test_queue_persistence.py::TestQueuePersistence::test_multiple_agents_multiple_days PASSED [ 56%]
tests/integration/test_queue_persistence.py::TestQueueDataIntegrity::test_queue_positions_sequential PASSED [ 56%]
tests/integration/test_queue_persistence.py::TestQueueDataIntegrity::test_queue_transaction_ids_valid PASSED [ 56%]
tests/integration/test_replay_identity_gold_standard.py::TestEventEnrichment::test_lsm_bilateral_offset_has_all_fields SKIPPED [ 56%]
tests/integration/test_replay_identity_gold_standard.py::TestEventEnrichment::test_lsm_cycle_settlement_has_all_fields SKIPPED [ 56%]
tests/integration/test_replay_identity_gold_standard.py::TestEventEnrichment::test_collateral_posted_has_all_fields SKIPPED [ 56%]
tests/integration/test_replay_identity_gold_standard.py::TestEventEnrichment::test_transaction_became_overdue_has_all_fields SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestFFIEventSerialization::test_ffi_serializes_lsm_bilateral_completely SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestPersistenceCompleteness::test_simulation_events_table_stores_enriched_lsm_events SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestReplayWithoutReconstruction::test_replay_does_not_query_lsm_cycles_table PASSED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestReplayWithoutReconstruction::test_replay_does_not_have_reconstruction_functions PASSED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestEndToEndReplayIdentity::test_lsm_bilateral_replays_identically SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestEndToEndReplayIdentity::test_lsm_cycle_replays_identically SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestEndToEndReplayIdentity::test_collateral_events_replay_identically SKIPPED [ 57%]
tests/integration/test_replay_identity_gold_standard.py::TestEndToEndReplayIdentity::test_all_event_types_replay_identically SKIPPED [ 58%]
tests/integration/test_replay_identity_gold_standard.py::TestRegressionBugs::test_bilateral_offset_agent_count_bug_fixed PASSED [ 58%]
tests/integration/test_replay_identity_gold_standard.py::TestRegressionBugs::test_event_field_name_consistency PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestReplayOutputDeterminism::test_log_agent_state_produces_identical_output PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestReplayOutputDeterminism::test_log_cost_breakdown_produces_identical_output PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestReplayOutputDeterminism::test_multiple_agents_all_produce_identical_output PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestReplayOutputDeterminism::test_determinism_with_transactions_in_queue PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestStateProviderDataEquivalence::test_both_providers_return_same_balance PASSED [ 58%]
tests/integration/test_replay_output_determinism.py::TestStateProviderDataEquivalence::test_both_providers_return_same_credit_limit PASSED [ 59%]
tests/integration/test_run_replay_byte_identical.py::TestRunReplayByteIdentical::test_run_and_replay_verbose_output_is_byte_identical PASSED [ 59%]
tests/integration/test_run_replay_byte_identical.py::TestRunReplayByteIdentical::test_multiple_runs_produce_same_hash PASSED [ 59%]
tests/integration/test_run_replay_byte_identical.py::TestRunReplayByteIdentical::test_replay_partial_tick_range_is_subset PASSED [ 59%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_transaction_metadata_in_arrival_event PASSED [ 59%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_collateral_events_reconstructed_from_simulation_events PASSED [ 59%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_cost_accrual_events_reconstructed_from_simulation_events PASSED [ 59%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_credit_utilization_calculated_from_balance_and_limit PASSED [ 59%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_lsm_bilateral_offset_events_reconstructed_from_simulation_events PASSED [ 60%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_credit_utilization_in_replay_eod_statistics PASSED [ 60%]
tests/integration/test_run_replay_identity.py::TestRunReplayIdentity::test_full_tick_output_identity PASSED [ 60%]
tests/integration/test_runner_migration.py::TestFeatureFlagBehavior::test_new_runner_used_by_default PASSED [ 60%]
tests/integration/test_runner_migration.py::TestFeatureFlagBehavior::test_old_runner_used_when_flag_disabled PASSED [ 60%]
tests/integration/test_runner_migration.py::TestFeatureFlagBehavior::test_new_runner_used_when_flag_enabled PASSED [ 60%]
tests/integration/test_runner_migration.py::TestVerboseModeEquivalence::test_verbose_mode_old_vs_new_identical_output SKIPPED [ 60%]
tests/integration/test_runner_migration.py::TestVerboseModeEquivalence::test_verbose_mode_with_persistence_equivalent SKIPPED [ 60%]
tests/integration/test_scenario_events_edge_cases.py::test_scenario_event_execution_order_same_tick PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_collateral_adjustment_affects_credit_limit PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_repeating_event_stops_at_end_of_simulation PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_arrival_rate_changes_affect_future_arrivals PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_global_arrival_rate_change_affects_all_agents PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_zero_amount_transfer_accepted PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_negative_interval_rejected PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_determinism_with_scenario_events PASSED [ 61%]
tests/integration/test_scenario_events_edge_cases.py::test_complex_scenario_with_multiple_event_types PASSED [ 62%]
tests/integration/test_scenario_events_edge_cases.py::test_event_at_tick_zero PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_direct_transfer_one_time PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_direct_transfer_repeating PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_collateral_adjustment PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_global_arrival_rate_change PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_agent_arrival_rate_change PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_multiple_events_same_tick PASSED [ 62%]
tests/integration/test_scenario_events_ffi.py::test_scenario_events_logged PASSED [ 63%]
tests/integration/test_scenario_events_ffi.py::test_invalid_event_type_rejected PASSED [ 63%]
tests/integration/test_scenario_events_ffi.py::test_missing_required_field_rejected PASSED [ 63%]
tests/integration/test_scenario_events_ffi.py::test_scenario_events_deterministic PASSED [ 63%]
tests/integration/test_scenario_events_persistence.py::test_scenario_event_persisted_to_database PASSED [ 63%]
tests/integration/test_scenario_events_persistence.py::test_multiple_scenario_events_persisted PASSED [ 63%]
tests/integration/test_scenario_events_persistence.py::test_repeating_scenario_events_persisted PASSED [ 63%]
tests/integration/test_scenario_events_persistence.py::test_scenario_event_details_structure PASSED [ 63%]
tests/integration/test_scenario_events_persistence.py::test_scenario_events_queryable_by_tick PASSED [ 63%]
tests/integration/test_scenario_events_replay_identity.py::test_direct_transfer_replay_identity PASSED [ 64%]
tests/integration/test_scenario_events_replay_identity.py::test_multiple_scenario_events_replay_identity PASSED [ 64%]
tests/integration/test_scenario_events_replay_identity.py::test_repeating_scenario_event_replay_identity PASSED [ 64%]
tests/integration/test_scenario_events_replay_identity.py::test_scenario_events_appear_in_verbose_output SKIPPED [ 64%]
tests/integration/test_scenario_replay_cli.py::test_scenario_events_replay_identity_simple PASSED [ 64%]
tests/integration/test_schema_migration.py::TestSchemaMigration::test_schema_column_mismatch_on_write PASSED [ 64%]
tests/integration/test_schema_migration.py::TestSchemaMigration::test_schema_validation_detects_missing_column PASSED [ 64%]
tests/integration/test_schema_migration.py::TestSchemaMigration::test_schema_reinitialization_after_validation_failure PASSED [ 64%]
tests/integration/test_settlement_classification.py::test_rtgs_immediate_creates_correct_event PASSED [ 65%]
tests/integration/test_settlement_classification.py::test_queue_release_creates_correct_event PASSED [ 65%]
tests/integration/test_settlement_classification.py::test_queue_release_not_labeled_as_rtgs_immediate PASSED [ 65%]
tests/integration/test_settlement_classification.py::test_lsm_bilateral_creates_correct_event PASSED [ 65%]
tests/integration/test_settlement_classification.py::test_lsm_cycle_creates_correct_event PASSED [ 65%]
tests/integration/test_settlement_classification.py::test_settlement_event_types_are_mutually_exclusive PASSED [ 65%]
tests/integration/test_settlement_count_fix.py::test_replay_counts_lsm_settled_transactions PASSED [ 65%]
tests/integration/test_settlement_rate_debug.py::test_settlement_rate_debug SKIPPED [ 65%]
tests/integration/test_settlement_rate_fix_verification.py::test_settlement_rate_fix_with_policy_that_splits PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataPersistence::test_both_tables_populated_together PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataPersistence::test_simulation_metadata_persisted_to_simulations_table PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataPersistence::test_simulation_metadata_matches_simulation_runs PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataPersistence::test_list_simulations_query_returns_data PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataPersistence::test_compare_simulations_query_works PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataSchema::test_simulations_table_exists PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataSchema::test_simulations_table_has_required_columns PASSED [ 66%]
tests/integration/test_simulation_metadata_persistence.py::TestSimulationMetadataValidation::test_simulation_record_validates_with_pydantic PASSED [ 67%]
tests/integration/test_smart_splitter_investigation.py::test_smart_splitter_splits_under_stress PASSED [ 67%]
tests/integration/test_smart_splitter_investigation.py::test_smart_splitter_with_negative_balance_bug_reproduction PASSED [ 67%]
tests/integration/test_split_parent_investigation.py::test_split_parent_investigation SKIPPED [ 67%]
tests/integration/test_split_transaction_settlement_rate.py::test_settlement_rate_bug_with_split_transactions SKIPPED [ 67%]
tests/integration/test_state_provider_contract.py::TestStateProviderContract::test_get_agent_balance_contract PASSED [ 67%]
tests/integration/test_state_provider_contract.py::TestStateProviderContract::test_get_agent_credit_limit_contract PASSED [ 67%]
tests/integration/test_ten_day_crisis_scenario.py::test_three_day_realistic_crisis_scenario_loads SKIPPED [ 67%]
tests/integration/test_ten_day_crisis_scenario.py::test_three_day_realistic_crisis_scenario_runs_full_simulation SKIPPED [ 68%]
tests/integration/test_ten_day_crisis_scenario.py::test_three_day_realistic_crisis_scenario_executes_all_event_types SKIPPED [ 68%]
tests/integration/test_ten_day_crisis_scenario.py::test_three_day_realistic_crisis_scenario_event_counts SKIPPED [ 68%]
tests/integration/test_ten_day_crisis_scenario.py::test_three_day_realistic_crisis_scenario_crisis_days_have_events SKIPPED [ 68%]
tests/integration/test_transaction_persistence.py::TestFFITransactionRetrieval::test_get_transactions_for_day_returns_list PASSED [ 68%]
tests/integration/test_transaction_persistence.py::TestFFITransactionRetrieval::test_get_transactions_for_day_returns_dicts_with_required_fields PASSED [ 68%]
tests/integration/test_transaction_persistence.py::TestFFITransactionRetrieval::test_get_transactions_for_day_filters_by_day PASSED [ 68%]
tests/integration/test_transaction_persistence.py::TestFFITransactionRetrieval::test_transaction_data_validates_with_pydantic_model PASSED [ 68%]
tests/integration/test_transaction_persistence.py::TestPolarsDataFrameConversion::test_create_polars_dataframe_from_transactions PASSED [ 69%]
tests/integration/test_transaction_persistence.py::TestDuckDBBatchWrite::test_insert_transactions_to_duckdb PASSED [ 69%]
tests/integration/test_transaction_persistence.py::TestDuckDBBatchWrite::test_batch_write_performance_40k_transactions PASSED [ 69%]
tests/integration/test_transaction_persistence.py::TestEndToEndTransactionPersistence::test_full_simulation_with_transaction_persistence PASSED [ 69%]
tests/integration/test_transaction_persistence.py::TestEndToEndTransactionPersistence::test_determinism_preserved_in_persistence PASSED [ 69%]
tests/integration/test_transaction_status_heuristic_bug.py::test_balance_heuristic_false_positive PASSED [ 69%]
tests/integration/test_transaction_status_heuristic_bug.py::test_balance_heuristic_with_matching_amounts PASSED [ 69%]
tests/integration/test_transaction_status_heuristic_bug.py::test_status_matches_orchestrator_ground_truth PASSED [ 69%]
tests/integration/test_transaction_status_heuristic_bug.py::test_transaction_status_with_multiple_balance_changes PASSED [ 70%]
tests/test_cli.py::TestCLIBasics::test_help_command PASSED               [ 70%]
tests/test_cli.py::TestCLIBasics::test_version_command PASSED            [ 70%]
tests/test_cli.py::TestCLIBasics::test_run_help PASSED                   [ 70%]
tests/test_cli.py::TestRunCommand::test_basic_run PASSED                 [ 70%]
tests/test_cli.py::TestRunCommand::test_quiet_mode PASSED                [ 70%]
tests/test_cli.py::TestRunCommand::test_stdout_stderr_separation PASSED  [ 70%]
tests/test_cli.py::TestRunCommand::test_seed_override PASSED             [ 70%]
tests/test_cli.py::TestRunCommand::test_ticks_override PASSED            [ 71%]
tests/test_cli.py::TestRunCommand::test_streaming_mode PASSED            [ 71%]
tests/test_cli.py::TestRunCommand::test_determinism PASSED               [ 71%]
tests/test_cli.py::TestRunCommand::test_invalid_config PASSED            [ 71%]
tests/test_cli.py::TestRunCommand::test_verbose_mode PASSED              [ 71%]
tests/test_cli.py::TestAIIntegration::test_jq_compatibility PASSED       [ 71%]
tests/test_cli.py::TestAIIntegration::test_parameter_sweep PASSED        [ 71%]
tests/test_cli.py::TestAIIntegration::test_streaming_real_time_monitoring PASSED [ 71%]
tests/unit/test_cli_db_commands.py::TestDBInitCommand::test_db_init_creates_database_file PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBInitCommand::test_db_init_creates_all_tables PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBInitCommand::test_db_init_is_idempotent PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBMigrateCommand::test_db_migrate_with_no_migrations PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBMigrateCommand::test_db_migrate_applies_pending_migrations PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBValidateCommand::test_db_validate_on_valid_schema PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBValidateCommand::test_db_validate_detects_missing_table PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBCreateMigrationCommand::test_db_create_migration_creates_file PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBCreateMigrationCommand::test_db_create_migration_increments_version PASSED [ 72%]
tests/unit/test_cli_db_commands.py::TestDBListCommand::test_db_list_shows_tables PASSED [ 73%]
tests/unit/test_config.py::test_load_simple_config PASSED                [ 73%]
tests/unit/test_config.py::test_config_validation_missing_required_fields PASSED [ 73%]
tests/unit/test_config.py::test_config_validation_invalid_values PASSED  [ 73%]
tests/unit/test_config.py::test_config_with_arrival_generation PASSED    [ 73%]
tests/unit/test_config.py::test_config_with_different_policies PASSED    [ 73%]
tests/unit/test_config.py::test_config_to_ffi_dict PASSED                [ 73%]
tests/unit/test_config.py::test_config_with_cost_rates PASSED            [ 73%]
tests/unit/test_config.py::test_config_with_lsm_settings PASSED          [ 74%]
tests/unit/test_config.py::test_lsm_config_ffi_dict_conversion PASSED    [ 74%]
tests/unit/test_config.py::test_lsm_config_defaults PASSED               [ 74%]
tests/unit/test_config.py::test_config_from_dict_directly PASSED         [ 74%]
tests/unit/test_database_manager.py::TestDatabaseManagerInit::test_database_manager_creates_connection PASSED [ 74%]
tests/unit/test_database_manager.py::TestDatabaseManagerInit::test_database_manager_creates_migrations_dir PASSED [ 74%]
tests/unit/test_database_manager.py::TestSchemaInitialization::test_initialize_schema_creates_tables PASSED [ 74%]
tests/unit/test_database_manager.py::TestSchemaInitialization::test_initialize_schema_uses_ddl_generator PASSED [ 74%]
tests/unit/test_database_manager.py::TestSchemaValidation::test_validate_schema_returns_true_for_valid_schema PASSED [ 75%]
tests/unit/test_database_manager.py::TestSchemaValidation::test_validate_schema_returns_false_for_invalid_schema PASSED [ 75%]
tests/unit/test_database_manager.py::TestMigrationApplication::test_apply_migrations_uses_migration_manager PASSED [ 75%]
tests/unit/test_database_manager.py::TestMigrationApplication::test_apply_migrations_records_in_migrations_table PASSED [ 75%]
tests/unit/test_database_manager.py::TestSetupMethod::test_setup_initializes_and_validates PASSED [ 75%]
tests/unit/test_database_manager.py::TestSetupMethod::test_setup_raises_on_invalid_schema PASSED [ 75%]
tests/unit/test_database_manager.py::TestConnectionManagement::test_close_closes_connection PASSED [ 75%]
tests/unit/test_database_manager.py::TestConnectionManagement::test_context_manager_support PASSED [ 75%]
tests/unit/test_database_manager.py::TestConvenienceFunctions::test_get_connection_returns_ready_connection PASSED [ 76%]
tests/unit/test_database_manager.py::TestConvenienceFunctions::test_get_connection_validates_schema PASSED [ 76%]
tests/unit/test_database_manager.py::TestMigrationDirectory::test_migrations_dir_created_automatically PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickAgentStateSchema::test_model_has_credit_limit_field PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickAgentStateSchema::test_model_has_collateral_field PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickAgentStateSchema::test_can_create_record_with_credit_limit PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickAgentStateSchema::test_credit_limit_field_is_integer PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickQueueSnapshotSchema::test_model_has_queue_type_field PASSED [ 76%]
tests/unit/test_database_schema.py::TestTickQueueSnapshotSchema::test_queue_type_supports_rtgs PASSED [ 77%]
tests/unit/test_database_schema.py::TestTickQueueSnapshotSchema::test_queue_type_supports_queue1 PASSED [ 77%]
tests/unit/test_database_schema.py::TestSchemaIntegration::test_agent_state_record_provides_all_stateprovider_data PASSED [ 77%]
tests/unit/test_database_state_provider_fix.py::test_remaining_amount_respects_current_tick PASSED [ 77%]
tests/unit/test_database_state_provider_fix.py::test_remaining_amount_after_settlement PASSED [ 77%]
tests/unit/test_database_state_provider_fix.py::test_remaining_amount_at_settlement_tick PASSED [ 77%]
tests/unit/test_database_state_provider_fix.py::test_unsettled_transaction PASSED [ 77%]
tests/unit/test_database_state_provider_fix.py::test_partial_settlement PASSED [ 77%]
tests/unit/test_deadline_capping.py::test_deadlines_capped_at_episode_end SKIPPED [ 78%]
tests/unit/test_deadline_capping.py::test_deadline_offset_respects_episode_boundary PASSED [ 78%]
tests/unit/test_deadline_capping.py::test_deadlines_reasonable_within_episode PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_no_filters_matches_all PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_event_type_single PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_event_type_multiple PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_agent_via_agent_id PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_agent_via_sender_id PASSED [ 78%]
tests/unit/test_event_filter.py::test_event_filter_agent_no_agent_field PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_transaction_id PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_transaction_id_missing PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_tick_range_min_only PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_tick_range_max_only PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_tick_range_both PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_multiple_filters_and_logic PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_all_none PASSED [ 79%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_event_types_single PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_event_types_multiple PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_event_types_with_spaces PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_agent PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_tx PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_tick_range_both PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_tick_range_min_only PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_tick_range_max_only PASSED [ 80%]
tests/unit/test_event_filter.py::test_event_filter_from_cli_args_all_filters PASSED [ 81%]
tests/unit/test_event_filter.py::test_event_filter_none_is_permissive PASSED [ 81%]
tests/unit/test_event_filter.py::test_event_filter_empty_lists_vs_none PASSED [ 81%]
tests/unit/test_migrations.py::TestMigrationManagerInit::test_creates_schema_migrations_table PASSED [ 81%]
tests/unit/test_migrations.py::TestMigrationManagerInit::test_schema_migrations_has_correct_columns PASSED [ 81%]
tests/unit/test_migrations.py::TestAppliedVersions::test_get_applied_versions_empty_initially PASSED [ 81%]
tests/unit/test_migrations.py::TestAppliedVersions::test_get_applied_versions_returns_versions PASSED [ 81%]
tests/unit/test_migrations.py::TestPendingMigrations::test_get_pending_migrations_empty_directory PASSED [ 81%]
tests/unit/test_migrations.py::TestPendingMigrations::test_get_pending_migrations_finds_sql_files PASSED [ 81%]
tests/unit/test_migrations.py::TestPendingMigrations::test_get_pending_migrations_parses_description PASSED [ 82%]
tests/unit/test_migrations.py::TestPendingMigrations::test_get_pending_migrations_excludes_applied PASSED [ 82%]
tests/unit/test_migrations.py::TestPendingMigrations::test_get_pending_migrations_returns_sorted PASSED [ 82%]
tests/unit/test_migrations.py::TestApplyMigration::test_apply_migration_executes_sql PASSED [ 82%]
tests/unit/test_migrations.py::TestApplyMigration::test_apply_migration_records_in_migrations_table PASSED [ 82%]
tests/unit/test_migrations.py::TestApplyMigration::test_apply_migration_rollback_on_error PASSED [ 82%]
tests/unit/test_migrations.py::TestApplyPendingMigrations::test_apply_pending_migrations_applies_all PASSED [ 82%]
tests/unit/test_migrations.py::TestApplyPendingMigrations::test_apply_pending_no_migrations PASSED [ 82%]
tests/unit/test_migrations.py::TestCreateMigrationTemplate::test_create_migration_template_creates_file PASSED [ 83%]
tests/unit/test_migrations.py::TestCreateMigrationTemplate::test_create_migration_template_increments_version PASSED [ 83%]
tests/unit/test_migrations.py::TestCreateMigrationTemplate::test_create_migration_template_has_content PASSED [ 83%]
tests/unit/test_migrations.py::TestMigrationEdgeCases::test_ignores_non_numeric_filenames PASSED [ 83%]
tests/unit/test_migrations.py::TestMigrationEdgeCases::test_handles_missing_migrations_directory PASSED [ 83%]
tests/unit/test_near_deadline_integrity.py::test_near_deadline_only_shows_queued_transactions PASSED [ 83%]
tests/unit/test_near_deadline_integrity.py::test_near_deadline_respects_settlement_timing PASSED [ 83%]
tests/unit/test_near_deadline_integrity.py::test_near_deadline_excludes_settled_before_current_tick PASSED [ 83%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_exists PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_orchestrator_provider PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_database_provider PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_both_providers_produce_identical_output PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_positive_balance_change PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_negative_balance_change PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_negative_balance PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_credit_utilization PASSED [ 84%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_queue_contents PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_with_collateral PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogAgentState::test_log_agent_state_quiet_mode PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_exists PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_with_orchestrator_provider PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_with_database_provider PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_both_providers_produce_identical_output_with_costs PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_shows_all_cost_types PASSED [ 85%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_shows_total PASSED [ 86%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_with_no_costs PASSED [ 86%]
tests/unit/test_output_unified.py::TestUnifiedLogCostBreakdown::test_log_cost_breakdown_quiet_mode PASSED [ 86%]
tests/unit/test_persistence_credit_limit.py::TestPersistenceManagerCapturesCreditLimit::test_persistence_manager_buffers_credit_limit PASSED [ 86%]
tests/unit/test_persistence_credit_limit.py::TestPersistenceManagerCapturesCreditLimit::test_all_agents_credit_limits_buffered PASSED [ 86%]
tests/unit/test_persistence_credit_limit.py::TestDatabaseStateProviderWithPersistedCreditLimit::test_database_state_provider_reads_credit_limit PASSED [ 86%]
tests/unit/test_persistence_manager.py::TestPersistenceManagerInitialization::test_initialization_without_full_replay PASSED [ 86%]
tests/unit/test_persistence_manager.py::TestPersistenceManagerInitialization::test_initialization_with_full_replay PASSED [ 86%]
tests/unit/test_persistence_manager.py::TestPersistInitialSnapshots::test_persist_initial_snapshots_writes_policies PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestPersistInitialSnapshots::test_persist_initial_snapshots_includes_policy_hash PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestOnTickComplete::test_on_tick_complete_no_op_without_full_replay PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestOnTickComplete::test_on_tick_complete_buffers_data_with_full_replay PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestOnDayComplete::test_on_day_complete_persists_eod_data PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestOnDayComplete::test_on_day_complete_flushes_replay_buffers PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestOnDayComplete::test_on_day_complete_skips_empty_buffers PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestPersistFinalMetadata::test_persist_final_metadata_calls_helper PASSED [ 87%]
tests/unit/test_persistence_manager.py::TestFullReplayBuffering::test_buffer_policy_decisions PASSED [ 88%]
tests/unit/test_persistence_manager.py::TestFullReplayBuffering::test_buffer_agent_states PASSED [ 88%]
tests/unit/test_persistence_manager.py::TestFullReplayBuffering::test_buffer_tracks_balance_changes PASSED [ 88%]
tests/unit/test_persistence_models.py::TestTransactionRecordMetadata::test_transaction_record_has_table_metadata PASSED [ 88%]
tests/unit/test_persistence_models.py::TestTransactionRecordMetadata::test_transaction_record_has_required_fields PASSED [ 88%]
tests/unit/test_persistence_models.py::TestTransactionRecordMetadata::test_transaction_record_field_types PASSED [ 88%]
tests/unit/test_persistence_models.py::TestSimulationRunRecordMetadata::test_simulation_run_record_has_table_metadata PASSED [ 88%]
tests/unit/test_persistence_models.py::TestSimulationRunRecordMetadata::test_simulation_run_record_has_required_fields PASSED [ 88%]
tests/unit/test_persistence_models.py::TestDailyAgentMetricsRecordMetadata::test_daily_metrics_record_has_table_metadata PASSED [ 89%]
tests/unit/test_persistence_models.py::TestDailyAgentMetricsRecordMetadata::test_daily_metrics_record_has_collateral_fields PASSED [ 89%]
tests/unit/test_persistence_models.py::TestCollateralEventRecordMetadata::test_collateral_event_record_has_table_metadata PASSED [ 89%]
tests/unit/test_persistence_models.py::TestCollateralEventRecordMetadata::test_collateral_event_record_has_required_fields PASSED [ 89%]
tests/unit/test_queue2_events.py::test_queue2_settlement_generates_distinct_event FAILED [ 89%]
tests/unit/test_queue2_events.py::test_queue2_drop_at_deadline SKIPPED   [ 89%]
tests/unit/test_queue2_events.py::test_settlement_event_still_emitted FAILED [ 89%]
tests/unit/test_queue2_settlement_events.py::test_queue2_settlement_emits_rtgs_queue2_settle_event SKIPPED [ 89%]
tests/unit/test_queue2_settlement_events.py::test_queued_rtgs_event_exists_for_queue2_entry SKIPPED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_one_time_schedule_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_repeating_schedule_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_direct_transfer_event_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_collateral_adjustment_event_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_arrival_rate_change_events_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_counterparty_weight_change_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_deadline_window_change_validation PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_simulation_config_with_scenario_events PASSED [ 90%]
tests/unit/test_scenario_event_schemas.py::test_simulation_config_validates_agent_references PASSED [ 91%]
tests/unit/test_scenario_event_schemas.py::test_simulation_config_to_ffi_dict_with_events PASSED [ 91%]
tests/unit/test_scenario_event_schemas.py::test_simulation_config_without_scenario_events PASSED [ 91%]
tests/unit/test_scenario_event_schemas.py::test_all_event_types_to_ffi PASSED [ 91%]
tests/unit/test_schema_generator.py::TestTypeMapping::test_python_to_sql_type_basic_types PASSED [ 91%]
tests/unit/test_schema_generator.py::TestTypeMapping::test_python_to_sql_type_datetime PASSED [ 91%]
tests/unit/test_schema_generator.py::TestTypeMapping::test_python_to_sql_type_enum PASSED [ 91%]
tests/unit/test_schema_generator.py::TestTypeMapping::test_python_to_sql_type_optional PASSED [ 91%]
tests/unit/test_schema_generator.py::TestCreateTableDDL::test_generate_simple_table_ddl PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateTableDDL::test_ddl_includes_not_null_constraints PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateTableDDL::test_ddl_allows_nulls_for_optional_fields PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateTableDDL::test_ddl_auto_increment_for_id_fields PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateIndexDDL::test_generate_indexes_ddl PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateIndexDDL::test_index_ddl_format PASSED [ 92%]
tests/unit/test_schema_generator.py::TestCreateIndexDDL::test_no_indexes_returns_empty_list PASSED [ 92%]
tests/unit/test_schema_generator.py::TestFullSchemaDDL::test_generate_full_schema_includes_all_tables PASSED [ 92%]
tests/unit/test_schema_generator.py::TestFullSchemaDDL::test_full_schema_includes_migrations_table PASSED [ 93%]
tests/unit/test_schema_generator.py::TestDDLValidation::test_model_without_table_name_raises_error PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationDetectsMissing::test_validate_detects_missing_column PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationDetectsMissing::test_validate_detects_multiple_missing_columns PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationDetectsExtra::test_validate_detects_extra_column PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationPasses::test_validate_passes_for_matching_schema PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationPasses::test_validate_all_core_models PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationMissingTable::test_validate_detects_missing_table PASSED [ 93%]
tests/unit/test_schema_validation.py::TestSchemaValidationDescriptiveErrors::test_error_messages_specify_table_name PASSED [ 94%]
tests/unit/test_schema_validation.py::TestSchemaValidationDescriptiveErrors::test_error_messages_specify_column_names PASSED [ 94%]
tests/unit/test_schema_validation.py::TestSchemaValidationEdgeCases::test_validate_handles_empty_model PASSED [ 94%]
tests/unit/test_schema_validation.py::TestSchemaValidationEdgeCases::test_validate_case_sensitivity PASSED [ 94%]
tests/unit/test_simulation_record_config_json.py::test_simulation_record_accepts_config_json PASSED [ 94%]
tests/unit/test_simulation_record_config_json.py::test_simulation_record_config_json_optional PASSED [ 94%]
tests/unit/test_simulation_record_config_json.py::test_simulation_record_serializes_correctly PASSED [ 94%]
tests/unit/test_simulation_record_config_json.py::test_simulation_record_with_large_config PASSED [ 94%]
tests/unit/test_simulation_runner.py::TestSimulationRunner::test_runner_calls_lifecycle_hooks_in_order PASSED [ 95%]
tests/unit/test_simulation_runner.py::TestSimulationRunner::test_runner_detects_eod_correctly PASSED [ 95%]
tests/unit/test_simulation_runner.py::TestSimulationRunner::test_runner_calls_persistence_hooks PASSED [ 95%]
tests/unit/test_simulation_runner.py::TestSimulationRunner::test_runner_tracks_statistics_correctly PASSED [ 95%]
tests/unit/test_simulation_runner.py::TestSimulationRunner::test_runner_applies_event_filter PASSED [ 95%]
tests/unit/test_simulation_stats.py::TestTickResult::test_tick_result_creation PASSED [ 95%]
tests/unit/test_simulation_stats.py::TestTickResult::test_tick_result_with_events PASSED [ 95%]
tests/unit/test_simulation_stats.py::TestSimulationStatsInitialization::test_initialization_zeros_all_totals PASSED [ 95%]
tests/unit/test_simulation_stats.py::TestSimulationStatsInitialization::test_initialization_zeros_day_stats PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsUpdate::test_update_increments_totals PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsUpdate::test_update_increments_day_stats PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsUpdate::test_update_accumulates_multiple_ticks PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsUpdate::test_update_handles_zero_values PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsDayStats::test_get_day_stats_returns_current_values PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsDayStats::test_get_day_stats_includes_accumulated_day_values PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsReset::test_reset_day_stats_zeros_day_counters PASSED [ 96%]
tests/unit/test_simulation_stats.py::TestSimulationStatsReset::test_reset_day_stats_preserves_totals PASSED [ 97%]
tests/unit/test_simulation_stats.py::TestSimulationStatsReset::test_reset_day_stats_allows_new_day_tracking PASSED [ 97%]
tests/unit/test_simulation_stats.py::TestSimulationStatsToDictionary::test_to_dict_returns_all_totals PASSED [ 97%]
tests/unit/test_simulation_stats.py::TestSimulationStatsToDictionary::test_to_dict_calculates_settlement_rate PASSED [ 97%]
tests/unit/test_simulation_stats.py::TestSimulationStatsToDictionary::test_to_dict_handles_zero_arrivals PASSED [ 97%]
tests/unit/test_simulation_stats.py::TestSimulationStatsToDictionary::test_to_dict_settlement_rate_precision PASSED [ 97%]
tests/unit/test_state_provider.py::TestStateProviderProtocol::test_protocol_has_all_required_methods PASSED [ 97%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_transaction_details PASSED [ 97%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_agent_balance PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_agent_credit_limit PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_agent_queue1_contents PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_rtgs_queue_contents PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_agent_collateral_posted PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_agent_accumulated_costs PASSED [ 98%]
tests/unit/test_state_provider.py::TestOrchestratorStateProvider::test_get_queue1_size PASSED [ 98%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_transaction_details PASSED [ 98%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_transaction_details_nonexistent PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_agent_balance PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_agent_credit_limit PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_agent_queue1_contents PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_rtgs_queue_contents PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_agent_collateral_posted PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_agent_accumulated_costs PASSED [ 99%]
tests/unit/test_state_provider.py::TestDatabaseStateProvider::test_get_queue1_size PASSED [ 99%]
tests/unit/test_state_provider.py::TestStateProviderEquivalence::test_orchestrator_and_database_providers_match PASSED [100%]

=================================== FAILURES ===================================
_______________ test_queue2_settlement_generates_distinct_event ________________

    def test_queue2_settlement_generates_distinct_event():
        """
        GIVEN a transaction in Queue-2 that can now settle
        WHEN liquidity becomes available and queue processes
        THEN a distinct RtgsQueue2Settle event should be emitted
        """
        from payment_simulator._core import Orchestrator
    
        config = {
            "seed": 12345,
            "rng_seed": 12345,
            "ticks_per_day": 100,
            "num_days": 1,
            "agent_configs": [
                {
                    "id": "BANK_A",
                    "opening_balance": 10000,  # $100 - insufficient for $500 payment
                    "credit_limit": 0,
                    "collateral_pool": 0,
                    "policy": {"type": "Fifo"},
                },
                {
                    "id": "BANK_B",
                    "opening_balance": 100000,
                    "credit_limit": 0,
                    "collateral_pool": 0,
                    "policy": {"type": "Fifo"},
                },
            ],
            "arrival_configs": [],  # No automatic arrivals
            "cost_model": {
                "overdraft_bps_per_tick": 0.8,
                "delay_per_tick_bps": 0.01,
                "deadline_penalty_bps": 5.0,
                "eod_penalty": 100000,
                "collateral_cost_per_tick_bps": 0.0005,
                "overdue_delay_multiplier": 5,
            },
            "settlement_config": {
                "lsm_enabled": False,  # Disable LSM to isolate Queue-2 behavior
            },
        }
    
        orch = Orchestrator.new(config)
    
        # Submit a transaction that will queue (insufficient liquidity)
        tx_id = orch.submit_transaction(
            sender="BANK_A",
            receiver="BANK_B",
            amount=50000,  # $500 - more than BANK_A's $100 balance
            deadline_tick=50,
            priority=5,
            divisible=False,
        )
    
        # Tick 0: Transaction should queue in Queue-2 (insufficient liquidity)
        orch.tick()
    
        tick0_events = orch.get_tick_events(0)
        queued_events = [e for e in tick0_events if e.get("event_type") == "QueuedRtgs"]
        assert len(queued_events) == 1, "Transaction should be queued in Queue-2"
        assert queued_events[0]["tx_id"] == tx_id
    
        # Verify tx is in Queue-2
        rtgs_queue = orch.get_rtgs_queue_contents()
        assert tx_id in rtgs_queue, f"TX {tx_id} should be in RTGS queue"
    
        # Add liquidity to BANK_A by submitting a transaction from BANK_B
        orch.submit_transaction(
            sender="BANK_B",
            receiver="BANK_A",
            amount=50000,  # Give BANK_A enough to settle
            deadline_tick=50,
            priority=10,  # High priority to settle immediately
            divisible=False,
        )
    
        # Tick 1: Transaction should settle from Queue-2
        orch.tick()
    
        tick1_events = orch.get_tick_events(1)
    
        # ASSERTION: Expect distinct RtgsQueue2Settle event (not generic Settlement)
        queue2_settle_events = [e for e in tick1_events if e.get("event_type") == "RtgsQueue2Settle"]
    
>       assert len(queue2_settle_events) == 1, (
            f"Expected 1 rtgs_queue2_settle event for Queue-2 settlement, "
            f"but got {len(queue2_settle_events)}. "
            f"Available events: {[e.get('event_type') for e in tick1_events]}"
        )
E       AssertionError: Expected 1 rtgs_queue2_settle event for Queue-2 settlement, but got 0. Available events: ['Arrival', 'PolicySubmit', 'RtgsImmediateSettlement', 'Settlement', 'Queue2LiquidityRelease', 'Settlement']
E       assert 0 == 1
E        +  where 0 = len([])

tests/unit/test_queue2_events.py:95: AssertionError
_____________________ test_settlement_event_still_emitted ______________________

    def test_settlement_event_still_emitted():
        """
        GIVEN a transaction settling from Queue-2
        WHEN RtgsQueue2Settle event is emitted
        THEN a generic Settlement event should ALSO be emitted for compatibility
    
        (Ensures backward compatibility with existing metrics/analysis that rely on Settlement events)
        """
        from payment_simulator._core import Orchestrator
    
        config = {
            "seed": 12345,
            "rng_seed": 12345,
            "ticks_per_day": 100,
            "num_days": 1,
            "agent_configs": [
                {
                    "id": "BANK_A",
                    "opening_balance": 10000,
                    "credit_limit": 0,
                    "collateral_pool": 0,
                    "policy": {"type": "Fifo"},
                },
                {
                    "id": "BANK_B",
                    "opening_balance": 100000,
                    "credit_limit": 0,
                    "collateral_pool": 0,
                    "policy": {"type": "Fifo"},
                },
            ],
            "arrival_configs": [],
            "cost_model": {
                "overdraft_bps_per_tick": 0.8,
                "delay_per_tick_bps": 0.01,
                "deadline_penalty_bps": 5.0,
                "eod_penalty": 100000,
                "collateral_cost_per_tick_bps": 0.0005,
                "overdue_delay_multiplier": 5,
            },
            "settlement_config": {
                "lsm_enabled": False,
            },
        }
    
        orch = Orchestrator.new(config)
    
        tx_id = orch.submit_transaction(
            sender="BANK_A",
            receiver="BANK_B",
            amount=50000,
            deadline_tick=50,
            priority=5,
            divisible=False,
        )
    
        orch.tick()  # Tick 0: Queue
    
        # Transfer funds to BANK_A to enable settlement
        # The transaction settles in the same tick as it arrives and then triggers queue processing
        orch.submit_transaction(
            sender="BANK_B",
            receiver="BANK_A",
            amount=50000,
            deadline_tick=55,
            priority=5,
            divisible=False,
        )
        orch.tick()  # Tick 1: Process transfer and settle queued transaction
    
        tick1_events = orch.get_tick_events(1)
    
        # Should have BOTH events
        settlement_events = [e for e in tick1_events if e.get("event_type") == "Settlement"]
        queue2_settle_events = [e for e in tick1_events if e.get("event_type") == "RtgsQueue2Settle"]
    
        assert len(settlement_events) >= 1, "Generic Settlement event should still exist for compatibility"
>       assert len(queue2_settle_events) == 1, "RtgsQueue2Settle event should also exist for audit trail"
E       AssertionError: RtgsQueue2Settle event should also exist for audit trail
E       assert 0 == 1
E        +  where 0 = len([])

tests/unit/test_queue2_events.py:206: AssertionError
=============================== warnings summary ===============================
tests/e2e/test_diagnostic_dashboard_e2e.py:155
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:155: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:185
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:185: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:227
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:227: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:254
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:254: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:280
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:280: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:302
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:302: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

tests/e2e/test_diagnostic_dashboard_e2e.py:332
  /home/user/SimCash/api/tests/e2e/test_diagnostic_dashboard_e2e.py:332: PytestUnknownMarkWarning: Unknown pytest.mark.e2e - is this a typo?  You can register custom marks to avoid this warning - for details, see https://docs.pytest.org/en/stable/how-to/mark.html
    @pytest.mark.e2e

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/unit/test_queue2_events.py::test_queue2_settlement_generates_distinct_event
FAILED tests/unit/test_queue2_events.py::test_settlement_event_still_emitted
= 2 failed, 758 passed, 50 skipped, 1 xpassed, 7 warnings in 311.05s (0:05:11) =
