{
  "version": "1.0",
  "tree_id": "liquidity_splitting_policy",
  "description": "Liquidity-aware splitting policy - intelligently splits large payments when liquidity is constrained",
  "root": {
    "type": "condition",
    "node_id": "N1",
    "description": "Check if past deadline",
    "condition": {
      "op": "<=",
      "left": { "field": "deadline_tick" },
      "right": { "field": "current_tick" }
    },
    "on_true": {
      "type": "action",
      "node_id": "A1",
      "action": "Drop"
    },
    "on_false": {
      "type": "condition",
      "node_id": "N2",
      "description": "Check if deadline is urgent (ticks_to_deadline <= 5)",
      "condition": {
        "op": "<=",
        "left": { "field": "ticks_to_deadline" },
        "right": { "value": 5.0 }
      },
      "on_true": {
        "type": "condition",
        "node_id": "N3",
        "description": "Urgent: Check if we can afford whole",
        "condition": {
          "op": ">=",
          "left": { "field": "balance" },
          "right": { "field": "amount" }
        },
        "on_true": {
          "type": "action",
          "node_id": "A2",
          "action": "Release"
        },
        "on_false": {
          "type": "condition",
          "node_id": "N4",
          "description": "Urgent but can't afford: Check if balance > 0",
          "condition": {
            "op": ">",
            "left": { "field": "balance" },
            "right": { "value": 0.0 }
          },
          "on_true": {
            "type": "action",
            "node_id": "A3",
            "action": "Split",
            "parameters": {
              "num_splits": { "param": "max_splits" }
            }
          },
          "on_false": {
            "type": "action",
            "node_id": "A4",
            "action": "Hold",
            "parameters": {
              "reason": { "value": "InsufficientLiquidity" }
            }
          }
        }
      },
      "on_false": {
        "type": "condition",
        "node_id": "N5",
        "description": "Not urgent: Check if we can afford whole",
        "condition": {
          "op": ">=",
          "left": { "field": "balance" },
          "right": { "field": "amount" }
        },
        "on_true": {
          "type": "action",
          "node_id": "A5",
          "action": "Release"
        },
        "on_false": {
          "type": "condition",
          "node_id": "N6",
          "description": "Can't afford whole, not urgent: Check if balance > 0 (can do partial)",
          "condition": {
            "op": ">",
            "left": { "field": "balance" },
            "right": { "value": 0.0 }
          },
          "on_true": {
            "type": "action",
            "node_id": "A7",
            "action": "Split",
            "parameters": {
              "num_splits": { "value": 2.0 }
            }
          },
          "on_false": {
            "type": "action",
            "node_id": "A6",
            "action": "Hold",
            "parameters": {
              "reason": { "value": "InsufficientLiquidity" }
            }
          }
        }
      }
    }
  },
  "parameters": {
    "max_splits": 4.0,
    "min_split_amount": 10000.0
  }
}
