{
  "version": "1.0",
  "policy_id": "efficient_memory_adaptive",
  "description": "Proactive policy that uses state registers to track liquidity stress trends over time, adapting buffers dynamically.",
  "parameters": {
    "base_buffer": 150000.0,
    "min_collateral_chunk": 500000.0,
    "stress_decay": 0.1,
    "stress_spike_trigger": 0.8,
    "high_stress_threshold": 5.0,
    "panic_threshold": 8.0
  },
  "bank_tree": {
    "node_id": "B_UpdateState",
    "type": "condition",
    "description": "Update the bank_state_stress based on current liquidity pressure",
    "condition": {
      "op": ">",
      "left": { "field": "liquidity_pressure" },
      "right": { "param": "stress_spike_trigger" }
    },
    "on_true": {
      "node_id": "B_IncStress",
      "type": "action",
      "action": "AddState",
      "parameters": {
        "key": { "value": "bank_state_stress" },
        "value": { "value": 1.0 },
        "reason": { "value": "High pressure detected" }
      }
    },
    "on_false": {
      "node_id": "B_DecStress",
      "type": "action",
      "action": "SetState",
      "parameters": {
        "key": { "value": "bank_state_stress" },
        "value": {
          "compute": {
            "op": "max",
            "values": [
              { "value": 0.0 },
              {
                "compute": {
                  "op": "-",
                  "left": { "field": "bank_state_stress" },
                  "right": { "param": "stress_decay" }
                }
              }
            ]
          }
        },
        "reason": { "value": "Decaying stress level" }
      }
    }
  },
  "strategic_collateral_tree": {
    "node_id": "S_CheckStress",
    "type": "condition",
    "description": "Post collateral proactively if memory indicates we are in a high stress regime",
    "condition": {
      "op": ">",
      "left": { "field": "bank_state_stress" },
      "right": { "param": "high_stress_threshold" }
    },
    "on_true": {
      "node_id": "S_PostDefensive",
      "type": "action",
      "action": "PostCollateral",
      "parameters": {
        "amount": { "param": "min_collateral_chunk" },
        "reason": { "value": "PreemptivePosting" },
        "auto_withdraw_after_ticks": { "value": 50 }
      }
    },
    "on_false": {
      "node_id": "S_Hold",
      "type": "action",
      "action": "HoldCollateral"
    }
  },
  "payment_tree": {
    "node_id": "P_PanicCheck",
    "type": "condition",
    "description": "If in panic mode (stress > 8), only release extremely urgent payments",
    "condition": {
      "op": "and",
      "conditions": [
        {
          "op": ">",
          "left": { "field": "bank_state_stress" },
          "right": { "param": "panic_threshold" }
        },
        {
          "op": "<",
          "left": { "field": "priority" },
          "right": { "value": 9 }
        }
      ]
    },
    "on_true": {
      "node_id": "A_HoldPanic",
      "type": "action",
      "action": "Hold",
      "parameters": { "reason": { "value": "InsufficientLiquidity" } }
    },
    "on_false": {
      "node_id": "P_StandardLogic",
      "type": "condition",
      "description": "Standard efficiency check: Release if liquidity > base_buffer",
      "condition": {
        "op": ">",
        "left": { "field": "available_liquidity" },
        "right": { "param": "base_buffer" }
      },
      "on_true": {
        "node_id": "A_Release",
        "type": "action",
        "action": "Release"
      },
      "on_false": {
        "node_id": "P_UrgentCheck",
        "type": "condition",
        "description": "If close to deadline, try to stagger split",
        "condition": {
          "op": "<",
          "left": { "field": "ticks_to_deadline" },
          "right": { "value": 10 }
        },
        "on_true": {
          "node_id": "A_Stagger",
          "type": "action",
          "action": "StaggerSplit",
          "parameters": {
            "num_splits": { "value": 5 },
            "stagger_first_now": { "value": 1 },
            "stagger_gap_ticks": { "value": 2 },
            "priority_boost_children": { "value": 2 }
          }
        },
        "on_false": {
          "node_id": "A_HoldNormal",
          "type": "action",
          "action": "Hold",
          "parameters": { "reason": { "value": "InsufficientLiquidity" } }
        }
      }
    }
  },
  "end_of_tick_collateral_tree": {
    "node_id": "E_Cleanup",
    "type": "condition",
    "description": "Only withdraw collateral if stress has fully decayed to 0",
    "condition": {
      "op": "==",
      "left": { "field": "bank_state_stress" },
      "right": { "value": 0.0 }
    },
    "on_true": {
      "node_id": "A_Withdraw",
      "type": "action",
      "action": "WithdrawCollateral",
      "parameters": {
        "amount": { "field": "excess_collateral" },
        "reason": { "value": "LiquidityRestored" }
      }
    },
    "on_false": {
      "node_id": "A_Hold",
      "type": "action",
      "action": "HoldCollateral"
    }
  }
}
