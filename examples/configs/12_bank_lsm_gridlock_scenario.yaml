# 12-Bank LSM Gridlock Stress Test
#
# THIS IS A STRESS-TEST VARIANT OF 12_bank_4_policy_comparison.yaml
#
# Key differences from the comparison scenario:
# - Liquidity reduced by ~95% (÷20) to create liquidity stress
# - Transaction amounts increased by 3-5x to stress liquidity further
# - Target: Liquidity/median-tx ratios of 5-20x (vs 100-2,600x in original)
#
# PURPOSE: Force transactions into RTGS Queue 2 to trigger LSM mechanisms
# - Without liquidity stress, all transactions settle immediately via RTGS
# - LSM bilateral offsetting and cycle detection only operate on queued transactions
# - This scenario creates gridlock conditions where LSM demonstrates value
#
# Configuration: Same 12 banks, 4 JSON policies, but under extreme liquidity constraints
# - Adaptive Liquidity Manager: Will heavily use collateral and delay decisions
# - Agile Regional Bank: Will rely heavily on payment splitting
# - Goliath National Bank: Conservative buffers will be challenged
# - Momentum Investment Bank: Aggressive strategy meets hard constraints
#
# Expected LSM activity:
# - Frequent bilateral offsetting (A→B and B→A netting)
# - Multi-party cycles (A→B→C→A) resolving gridlock
# - Clear difference in settlement rates with LSM enabled vs disabled

simulation:
  ticks_per_day: 200
  num_days: 5
  rng_seed: 42

# ============================================================================
# POLICY 1: ADAPTIVE LIQUIDITY MANAGER (3 configurations)
# Under stress: Will heavily rely on collateral and strategic timing
# ============================================================================

agents:
  # ==========================================================================
  # ALM-1: Conservative Configuration (STRESSED)
  # ==========================================================================
  - id: "ALM_CONSERVATIVE"
    opening_balance: 2500000     # $25,000 (was $500,000) - 95% reduction
    credit_limit: 1500000        # $15,000 (was $300,000) - 95% reduction
    policy:
      type: "FromJson"
      json_path: "backend/policies/adaptive_liquidity_manager.json"
    arrival_config:
      rate_per_tick: 0.4         # ~80 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 13.0               # ~$4,420 median (was ~$1,000) - 4.4x increase
        std_dev: 0.8
      counterparty_weights:
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.08
        ARB_LARGE_REGIONAL: 0.12
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.08
        MIB_HEDGE_FUND_DESK: 0.05
        MIB_PROP_TRADING: 0.02
      deadline_range: [50, 150]
      priority: 5
      divisible: false

  # ==========================================================================
  # ALM-2: Balanced Configuration (STRESSED)
  # ==========================================================================
  - id: "ALM_BALANCED"
    opening_balance: 1500000     # $15,000 (was $300,000)
    credit_limit: 1250000        # $12,500 (was $250,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/adaptive_liquidity_manager.json"
    arrival_config:
      rate_per_tick: 0.6         # ~120 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 12.5               # ~$2,700 median (was ~$600) - 4.5x increase
        std_dev: 1.0
      counterparty_weights:
        ALM_CONSERVATIVE: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_MEDIUM_REGIONAL: 0.12
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.12
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.08
        MIB_HEDGE_FUND_DESK: 0.06
        MIB_PROP_TRADING: 0.02
      deadline_range: [30, 100]
      priority: 5
      divisible: false

  # ==========================================================================
  # ALM-3: Aggressive Configuration (STRESSED)
  # ==========================================================================
  - id: "ALM_AGGRESSIVE"
    opening_balance: 1000000     # $10,000 (was $200,000)
    credit_limit: 1750000        # $17,500 (was $350,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/adaptive_liquidity_manager.json"
    arrival_config:
      rate_per_tick: 0.8         # ~160 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 12.0               # ~$1,630 median (was ~$297) - 5.5x increase
        std_dev: 1.2
      counterparty_weights:
        ALM_CONSERVATIVE: 0.08
        ALM_BALANCED: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.10
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.08
        MIB_HEDGE_FUND_DESK: 0.05
        MIB_PROP_TRADING: 0.02
      deadline_range: [20, 80]
      priority: 6
      divisible: false

# ============================================================================
# POLICY 2: AGILE REGIONAL BANK (3 configurations)
# Under stress: Payment splitting will be critical for operation
# ============================================================================

  # ==========================================================================
  # ARB-1: Large Regional Configuration (STRESSED)
  # ==========================================================================
  - id: "ARB_LARGE_REGIONAL"
    opening_balance: 2250000     # $22,500 (was $450,000)
    credit_limit: 1400000        # $14,000 (was $280,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/agile_regional_bank.json"
    arrival_config:
      rate_per_tick: 0.5         # ~100 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 250000              # $2,500 (was $500) - 5x increase
        max: 4000000             # $40,000 (was $8,000) - 5x increase
      counterparty_weights:
        ALM_CONSERVATIVE: 0.12
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.07
        MIB_HEDGE_FUND_DESK: 0.04
        MIB_PROP_TRADING: 0.02
      deadline_range: [40, 120]
      priority: 5
      divisible: true            # Splitting will be essential

  # ==========================================================================
  # ARB-2: Medium Regional Configuration (STRESSED)
  # ==========================================================================
  - id: "ARB_MEDIUM_REGIONAL"
    opening_balance: 1400000     # $14,000 (was $280,000)
    credit_limit: 1100000        # $11,000 (was $220,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/agile_regional_bank.json"
    arrival_config:
      rate_per_tick: 0.55        # ~110 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 200000              # $2,000 (was $400) - 5x increase
        max: 3000000             # $30,000 (was $6,000) - 5x increase
      counterparty_weights:
        ALM_CONSERVATIVE: 0.10
        ALM_BALANCED: 0.12
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.10
        GNB_TIER1_BEHEMOTH: 0.12
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.08
        MIB_HEDGE_FUND_DESK: 0.04
        MIB_PROP_TRADING: 0.02
      deadline_range: [30, 100]
      priority: 5
      divisible: true

  # ==========================================================================
  # ARB-3: Small Regional Configuration (STRESSED)
  # ==========================================================================
  - id: "ARB_SMALL_REGIONAL"
    opening_balance: 900000      # $9,000 (was $180,000)
    credit_limit: 1000000        # $10,000 (was $200,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/agile_regional_bank.json"
    arrival_config:
      rate_per_tick: 0.65        # ~130 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 150000              # $1,500 (was $300) - 5x increase
        max: 2500000             # $25,000 (was $5,000) - 5x increase
      counterparty_weights:
        ALM_CONSERVATIVE: 0.08
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.08
        ARB_MEDIUM_REGIONAL: 0.10
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.08
        MIB_HEDGE_FUND_DESK: 0.06
        MIB_PROP_TRADING: 0.03
      deadline_range: [25, 90]
      priority: 6
      divisible: true

# ============================================================================
# POLICY 3: GOLIATH NATIONAL BANK (3 configurations)
# Under stress: Conservative buffers will be tested, collateral critical
# ============================================================================

  # ==========================================================================
  # GNB-1: Tier 1 Behemoth Configuration (STRESSED)
  # ==========================================================================
  - id: "GNB_TIER1_BEHEMOTH"
    opening_balance: 4000000     # $40,000 (was $800,000)
    credit_limit: 2500000        # $25,000 (was $500,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/goliath_national_bank.json"
    arrival_config:
      rate_per_tick: 0.7         # ~140 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 13.5               # ~$7,300 median (was ~$1,628) - 4.5x increase
        std_dev: 1.0
      counterparty_weights:
        ALM_CONSERVATIVE: 0.10
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.08
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.10
        MIB_HEDGE_FUND_DESK: 0.07
        MIB_PROP_TRADING: 0.03
      deadline_range: [60, 160]
      priority: 7
      divisible: false

  # ==========================================================================
  # GNB-2: Major National Configuration (STRESSED)
  # ==========================================================================
  - id: "GNB_MAJOR_NATIONAL"
    opening_balance: 2750000     # $27,500 (was $550,000)
    credit_limit: 1900000        # $19,000 (was $380,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/goliath_national_bank.json"
    arrival_config:
      rate_per_tick: 0.65        # ~130 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 13.0               # ~$4,420 median (was ~$987) - 4.5x increase
        std_dev: 0.9
      counterparty_weights:
        ALM_CONSERVATIVE: 0.10
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.10
        MIB_HEDGE_FUND_DESK: 0.07
        MIB_PROP_TRADING: 0.03
      deadline_range: [50, 140]
      priority: 6
      divisible: false

  # ==========================================================================
  # GNB-3: Regional National Configuration (STRESSED)
  # ==========================================================================
  - id: "GNB_REGIONAL_NATIONAL"
    opening_balance: 1900000     # $19,000 (was $380,000)
    credit_limit: 1400000        # $14,000 (was $280,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/goliath_national_bank.json"
    arrival_config:
      rate_per_tick: 0.55        # ~110 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 12.5               # ~$2,700 median (was ~$600) - 4.5x increase
        std_dev: 0.85
      counterparty_weights:
        ALM_CONSERVATIVE: 0.10
        ALM_BALANCED: 0.10
        ALM_AGGRESSIVE: 0.10
        ARB_LARGE_REGIONAL: 0.10
        ARB_MEDIUM_REGIONAL: 0.10
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.12
        GNB_MAJOR_NATIONAL: 0.12
        MIB_PRIME_BROKER: 0.09
        MIB_HEDGE_FUND_DESK: 0.06
        MIB_PROP_TRADING: 0.03
      deadline_range: [40, 120]
      priority: 5
      divisible: false

# ============================================================================
# POLICY 4: MOMENTUM INVESTMENT BANK (3 configurations)
# Under stress: Aggressive strategy will hit hard liquidity constraints
# ============================================================================

  # ==========================================================================
  # MIB-1: Prime Broker Configuration (STRESSED)
  # ==========================================================================
  - id: "MIB_PRIME_BROKER"
    opening_balance: 2100000     # $21,000 (was $420,000)
    credit_limit: 1600000        # $16,000 (was $320,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/momentum_investment_bank.json"
    arrival_config:
      rate_per_tick: 0.9         # ~180 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 12.2               # ~$2,200 median (was ~$490) - 4.5x increase
        std_dev: 1.3
      counterparty_weights:
        ALM_CONSERVATIVE: 0.08
        ALM_BALANCED: 0.08
        ALM_AGGRESSIVE: 0.08
        ARB_LARGE_REGIONAL: 0.07
        ARB_MEDIUM_REGIONAL: 0.08
        ARB_SMALL_REGIONAL: 0.08
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_HEDGE_FUND_DESK: 0.10
        MIB_PROP_TRADING: 0.06
      deadline_range: [20, 80]
      priority: 7
      divisible: false

  # ==========================================================================
  # MIB-2: Hedge Fund Desk Configuration (STRESSED)
  # ==========================================================================
  - id: "MIB_HEDGE_FUND_DESK"
    opening_balance: 1600000     # $16,000 (was $320,000)
    credit_limit: 1400000        # $14,000 (was $280,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/momentum_investment_bank.json"
    arrival_config:
      rate_per_tick: 1.0         # ~200 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 11.7               # ~$1,330 median (was ~$297) - 4.5x increase
        std_dev: 1.4
      counterparty_weights:
        ALM_CONSERVATIVE: 0.05
        ALM_BALANCED: 0.06
        ALM_AGGRESSIVE: 0.05
        ARB_LARGE_REGIONAL: 0.04
        ARB_MEDIUM_REGIONAL: 0.06
        ARB_SMALL_REGIONAL: 0.06
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.10
        MIB_PROP_TRADING: 0.21
      deadline_range: [15, 70]
      priority: 6
      divisible: false

  # ==========================================================================
  # MIB-3: Prop Trading Configuration (STRESSED)
  # ==========================================================================
  - id: "MIB_PROP_TRADING"
    opening_balance: 1250000     # $12,500 (was $250,000)
    credit_limit: 1100000        # $11,000 (was $220,000)
    policy:
      type: "FromJson"
      json_path: "backend/policies/momentum_investment_bank.json"
    arrival_config:
      rate_per_tick: 1.1         # ~220 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 11.2               # ~$810 median (was ~$180) - 4.5x increase
        std_dev: 1.5
      counterparty_weights:
        ALM_CONSERVATIVE: 0.02
        ALM_BALANCED: 0.02
        ALM_AGGRESSIVE: 0.02
        ARB_LARGE_REGIONAL: 0.02
        ARB_MEDIUM_REGIONAL: 0.03
        ARB_SMALL_REGIONAL: 0.03
        GNB_TIER1_BEHEMOTH: 0.15
        GNB_MAJOR_NATIONAL: 0.12
        GNB_REGIONAL_NATIONAL: 0.10
        MIB_PRIME_BROKER: 0.06
        MIB_HEDGE_FUND_DESK: 0.43
      deadline_range: [10, 60]
      priority: 5
      divisible: false

# ============================================================================
# LSM CONFIGURATION
# CRITICAL: LSM is the primary gridlock resolution mechanism in this scenario
# ============================================================================

lsm_config:
  enable_bilateral: true        # Bilateral offsetting will be HEAVILY used
  enable_cycles: true            # Cycle detection critical for multi-party gridlock
  max_cycle_length: 6            # Increased to 6 for complex gridlock patterns
  max_cycles_per_tick: 15        # Increased capacity for high LSM activity

# ============================================================================
# COST CONFIGURATION
# Same as comparison scenario - makes metrics directly comparable
# ============================================================================

cost_rates:
  overdraft_bps_per_tick: 0.5
  delay_cost_per_tick_per_cent: 0.0001
  collateral_cost_per_tick_bps: 0.0003
  eod_penalty_per_transaction: 500000       # $5,000 penalty
  deadline_penalty: 250000                  # $2,500 penalty
  split_friction_cost: 5000                 # $50 cost to split

# ============================================================================
# EXPECTED LSM DYNAMICS
# ============================================================================
#
# With 95% liquidity reduction and 3-5x larger transactions:
#
# 1. RTGS Queue 2 will fill up significantly
#    - Many transactions will fail immediate RTGS settlement
#    - Queue depths of 50-200 transactions expected during peak times
#    - Creates opportunities for bilateral and cycle-based offsetting
#
# 2. Bilateral Offsetting (A↔B netting) will trigger frequently
#    - Expect 20-50 bilateral pairs per day
#    - Particularly effective for banks with balanced flows (MIB↔MIB, ALM↔GNB)
#    - Will reduce queue depth and improve settlement rates
#
# 3. Cycle Detection will resolve complex gridlock
#    - Expect 5-15 cycles per day (3-6 party cycles)
#    - Critical during end-of-day rushes when many agents are constrained
#    - Unlocks circular waiting patterns that bilateral offsetting can't solve
#
# 4. Policy effectiveness under stress:
#    - ALM: Collateral management becomes critical, not just nice-to-have
#    - ARB: Payment splitting transforms from optimization to necessity
#    - GNB: Conservative buffers may be insufficient, forcing adaptations
#    - MIB: Aggressive release strategy creates queue pressure, tests LSM limits
#
# 5. Comparative metrics to measure LSM effectiveness:
#    - Settlement rate: LSM enabled vs disabled (expect 15-30% improvement)
#    - Queue depth: Peak and average (expect 40-60% reduction with LSM)
#    - End-of-day unsettled: Critical metric (expect 50-80% reduction)
#    - Total system cost: Delay penalties dominate without LSM
#
# 6. Recommended analysis:
#    - Run with enable_bilateral=false, enable_cycles=false to see baseline
#    - Run with only enable_bilateral=true to isolate bilateral value
#    - Run with both enabled to see full LSM effectiveness
#    - Compare RTGS queue visualizations across all three runs
#
# This scenario demonstrates LSM's value proposition: without it, the system
# experiences severe gridlock. With it, the system remains operational despite
# extreme liquidity constraints.
