# Ten-Day Realistic Financial Crisis Scenario
#
# This scenario demonstrates a REALISTIC crisis that shows both emergence and resolution
# without spiraling into unrealistic gridlock. Unlike ten_day_crisis_scenario.yaml,
# this uses moderate parameters that mirror actual financial system stress events.
#
# KEY DIFFERENCES FROM SEVERE VERSION:
# ✅ 2-3x higher opening balances (realistic capital ratios)
# ✅ 10x lower penalties ($250 deadline penalty vs $2,500)
# ✅ Moderate deadline tightening (0.8× vs 0.4×)
# ✅ Smaller collateral haircuts (20-30% vs 50%)
# ✅ More effective central bank interventions
# ✅ Demonstrates actual crisis RESOLUTION
#
# SCENARIO EVENT TYPES DEMONSTRATED:
# ✅ CustomTransactionArrival - Stress testing large institutional payments
# ✅ CollateralAdjustment - Regulatory margin calls and restorations
# ✅ GlobalArrivalRateChange - Market-wide activity changes
# ✅ AgentArrivalRateChange - Bank operational issues and recovery
# ✅ CounterpartyWeightChange - Credit relationship adjustments
# ✅ DeadlineWindowChange - System-wide regulatory policy shifts
#
# NARRATIVE: "A Managed Crisis with Resolution"
#
# Five banks navigate a realistic 10-day stress period:
# - Days 1-2: Normal operations (baseline)
# - Day 3: Market volatility spike with large payment stress
# - Day 4: Moderate regulatory collateral requirements increase
# - Day 5: REGIONAL_TRUST experiences temporary operational issues
# - Day 6: Swift central bank support prevents contagion
# - Day 7-8: Coordinated recovery - operations normalize, relationships rebuild
# - Day 9: New regulatory framework establishes sustainable equilibrium
# - Day 10: System successfully passes final stress test
#
# Configuration: 50 ticks/day × 10 days = 500 total ticks

simulation:
  ticks_per_day: 50   # 50 ticks per day
  num_days: 10        # 10-day scenario
  rng_seed: 42        # Deterministic for reproducibility

# ============================================================================
# AGENTS - Higher balances, sustainable configuration
# ============================================================================

agents:
  # METRO_CENTRAL - Large Money Center Bank
  - id: "METRO_CENTRAL"
    opening_balance: 35000000         # $350,000 (2.5× more than severe version)
    credit_limit: 5000000             # $50,000 (5× more)
    policy:
      type: "FromJson"
      json_path: "backend/policies/goliath_national_bank.json"
    arrival_config:
      rate_per_tick: 0.4              # ~20 tx/day (reduced from 0.525)
      amount_distribution:
        type: "LogNormal"
        mean: 11.5                    # ~$1,000 median (lower than severe)
        std_dev: 0.8
      counterparty_weights:
        CORRESPONDENT_HUB: 0.40
        REGIONAL_TRUST: 0.25
        MOMENTUM_CAPITAL: 0.20
        COMMUNITY_FIRST: 0.15
      deadline_range: [20, 40]        # Longer deadlines (vs [15, 35])
      priority: 6
      divisible: false

  # REGIONAL_TRUST - Regional Bank (temporary operational issues Day 5)
  - id: "REGIONAL_TRUST"
    opening_balance: 22000000         # $220,000 (2.4× more)
    credit_limit: 3500000             # $35,000 (5× more)
    policy:
      type: "FromJson"
      json_path: "backend/policies/agile_regional_bank.json"
    arrival_config:
      rate_per_tick: 0.35             # ~17 tx/day (reduced)
      amount_distribution:
        type: "Uniform"
        min: 60000                    # $600 (lower)
        max: 400000                   # $4,000 (lower)
      counterparty_weights:
        CORRESPONDENT_HUB: 0.35
        METRO_CENTRAL: 0.25
        MOMENTUM_CAPITAL: 0.20
        COMMUNITY_FIRST: 0.20
      deadline_range: [18, 38]
      priority: 5
      divisible: true

  # MOMENTUM_CAPITAL - Investment Bank (conservative policy)
  - id: "MOMENTUM_CAPITAL"
    opening_balance: 28000000         # $280,000 (2.5× more)
    credit_limit: 4000000             # $40,000 (5× more)
    policy:
      type: "FromJson"
      json_path: "backend/policies/cautious_liquidity_preserver.json"
    arrival_config:
      rate_per_tick: 0.45             # ~22 tx/day (reduced)
      amount_distribution:
        type: "LogNormal"
        mean: 10.0                    # ~$400 median (lower)
        std_dev: 1.2
      counterparty_weights:
        CORRESPONDENT_HUB: 0.30
        METRO_CENTRAL: 0.25
        REGIONAL_TRUST: 0.25
        COMMUNITY_FIRST: 0.20
      deadline_range: [15, 35]
      priority: 7
      divisible: false

  # COMMUNITY_FIRST - Smaller Bank (undercapitalized but viable)
  - id: "COMMUNITY_FIRST"
    opening_balance: 15000000         # $150,000 (3× more)
    credit_limit: 2500000             # $25,000 (5× more)
    policy:
      type: "FromJson"
      json_path: "backend/policies/balanced_cost_optimizer.json"
    arrival_config:
      rate_per_tick: 0.4              # ~20 tx/day (reduced)
      amount_distribution:
        type: "LogNormal"
        mean: 10.5                    # ~$500 median (lower)
        std_dev: 1.0
      counterparty_weights:
        CORRESPONDENT_HUB: 0.35
        METRO_CENTRAL: 0.25
        REGIONAL_TRUST: 0.25
        MOMENTUM_CAPITAL: 0.15
      deadline_range: [18, 38]
      priority: 6
      divisible: false

  # CORRESPONDENT_HUB - Central Correspondent Bank
  - id: "CORRESPONDENT_HUB"
    opening_balance: 30000000         # $300,000 (2.5× more)
    credit_limit: 4000000             # $40,000 (5× more)
    policy:
      type: "FromJson"
      json_path: "backend/policies/smart_splitter.json"
    arrival_config:
      rate_per_tick: 0.4              # ~20 tx/day (reduced)
      amount_distribution:
        type: "Uniform"
        min: 80000                    # $800 (lower)
        max: 500000                   # $5,000 (lower)
      counterparty_weights:
        METRO_CENTRAL: 0.30
        REGIONAL_TRUST: 0.25
        MOMENTUM_CAPITAL: 0.25
        COMMUNITY_FIRST: 0.20
      deadline_range: [20, 40]
      priority: 6
      divisible: true

  # CENTRAL_BANK - Emergency Liquidity Provider (passive, receives only)
  - id: "CENTRAL_BANK"
    opening_balance: 100000000        # $1,000,000 (ample reserves)
    credit_limit: 0                   # No credit needed
    policy:
      type: "Fifo"
    arrival_config:
      rate_per_tick: 0.0              # Doesn't send payments (except interventions)
      amount_distribution:
        type: "Uniform"
        min: 100000
        max: 200000
      counterparty_weights:
        METRO_CENTRAL: 1.0
      deadline_range: [10, 20]
      priority: 5
      divisible: false

# ============================================================================
# SCENARIO EVENTS - Realistic 10-Day Crisis Timeline with Resolution
# ============================================================================

scenario_events:
  # ========================================================================
  # DAY 1-2 (Ticks 0-99): Normal Operations Baseline
  # ========================================================================
  # No events - establish normal performance baseline

  # ========================================================================
  # DAY 3 (Ticks 100-149): Market Volatility Spike
  # ========================================================================

  # Morning (tick 105): Moderate market activity increase
  - type: GlobalArrivalRateChange
    multiplier: 1.4  # 40% increase (vs 2.0× in severe version)
    schedule:
      type: OneTime
      tick: 105

  # Mid-morning (tick 112): Large institutional payment
  - type: CustomTransactionArrival
    from_agent: METRO_CENTRAL
    to_agent: CORRESPONDENT_HUB
    amount: 3000000   # $30,000 (vs $50,000 in severe)
    priority: 8
    deadline: 20
    is_divisible: true  # Allow splitting for resilience
    schedule:
      type: OneTime
      tick: 112

  # Afternoon (tick 130): Markets stabilize
  - type: GlobalArrivalRateChange
    multiplier: 1.1  # Slightly elevated (vs 1.5× in severe)
    schedule:
      type: OneTime
      tick: 130

  # ========================================================================
  # DAY 4 (Ticks 150-199): Moderate Regulatory Adjustments
  # ========================================================================

  # Morning (tick 155): Markets return to normal
  - type: GlobalArrivalRateChange
    multiplier: 1.0
    schedule:
      type: OneTime
      tick: 155

  # Mid-morning (tick 160-170): Regulatory collateral adjustments (20-30% haircuts)
  # These represent realistic margin requirements, not draconian cuts

  - type: CollateralAdjustment
    agent: METRO_CENTRAL
    delta: -1000000  # Lose $10,000 (20% of credit limit vs 50%)
    schedule:
      type: OneTime
      tick: 160

  - type: CollateralAdjustment
    agent: REGIONAL_TRUST
    delta: -700000  # Lose $7,000 (20% of credit limit)
    schedule:
      type: OneTime
      tick: 162

  - type: CollateralAdjustment
    agent: MOMENTUM_CAPITAL
    delta: -800000  # Lose $8,000 (20% of credit limit)
    schedule:
      type: OneTime
      tick: 164

  - type: CollateralAdjustment
    agent: COMMUNITY_FIRST
    delta: -500000  # Lose $5,000 (20% of credit limit)
    schedule:
      type: OneTime
      tick: 166

  - type: CollateralAdjustment
    agent: CORRESPONDENT_HUB
    delta: -800000  # Lose $8,000 (20% of credit limit)
    schedule:
      type: OneTime
      tick: 168

  # Afternoon (tick 180): Moderate deadline tightening (regulatory response)
  - type: DeadlineWindowChange
    min_ticks_multiplier: 0.85  # Tighten by 15% (vs 50% in severe)
    max_ticks_multiplier: 0.85  # Moderate tightening
    schedule:
      type: OneTime
      tick: 180

  # ========================================================================
  # DAY 5 (Ticks 200-249): REGIONAL_TRUST Temporary Operational Issues
  # ========================================================================

  # Morning (tick 205): REGIONAL_TRUST experiences temporary system slowdown
  - type: AgentArrivalRateChange
    agent: REGIONAL_TRUST
    multiplier: 0.3  # 30% capacity (vs 0.1% in severe - complete halt)
    schedule:
      type: OneTime
      tick: 205

  # Ticks 210-218: Counterparties prudently reduce exposure (but don't flee)
  - type: CounterpartyWeightChange
    agent: METRO_CENTRAL
    counterparty: REGIONAL_TRUST
    new_weight: 0.15  # Reduce from 0.25 to 0.15 (vs 0.05 in severe)
    schedule:
      type: OneTime
      tick: 210

  - type: CounterpartyWeightChange
    agent: MOMENTUM_CAPITAL
    counterparty: REGIONAL_TRUST
    new_weight: 0.15
    schedule:
      type: OneTime
      tick: 212

  - type: CounterpartyWeightChange
    agent: COMMUNITY_FIRST
    counterparty: REGIONAL_TRUST
    new_weight: 0.15
    schedule:
      type: OneTime
      tick: 215

  - type: CounterpartyWeightChange
    agent: CORRESPONDENT_HUB
    counterparty: REGIONAL_TRUST
    new_weight: 0.15
    schedule:
      type: OneTime
      tick: 218

  # ========================================================================
  # DAY 6 (Ticks 250-299): Swift Central Bank Intervention
  # ========================================================================

  # Morning (tick 255): Targeted central bank support (faster than severe version)
  - type: CustomTransactionArrival
    from_agent: CENTRAL_BANK
    to_agent: REGIONAL_TRUST
    amount: 3000000   # $30,000 direct support to affected bank
    priority: 10
    deadline: 5
    is_divisible: false
    schedule:
      type: OneTime
      tick: 255

  # Tick 260: Precautionary support to COMMUNITY_FIRST
  - type: CustomTransactionArrival
    from_agent: CENTRAL_BANK
    to_agent: COMMUNITY_FIRST
    amount: 1500000   # $15,000
    priority: 10
    deadline: 5
    is_divisible: false
    schedule:
      type: OneTime
      tick: 260

  # Midday (tick 270): Brief market volatility (contained)
  - type: GlobalArrivalRateChange
    multiplier: 1.3  # Modest increase (vs 2.5× panic in severe)
    schedule:
      type: OneTime
      tick: 270

  # Afternoon (tick 285): Volatility subsides quickly
  - type: GlobalArrivalRateChange
    multiplier: 1.0
    schedule:
      type: OneTime
      tick: 285

  # ========================================================================
  # DAY 7 (Ticks 300-349): Recovery Begins
  # ========================================================================

  # Morning (tick 305): REGIONAL_TRUST operations improving
  - type: AgentArrivalRateChange
    agent: REGIONAL_TRUST
    multiplier: 0.7  # 70% capacity restored (faster recovery)
    schedule:
      type: OneTime
      tick: 305

  # Midday (tick 320): Collateral requirements partially relaxed
  - type: CollateralAdjustment
    agent: REGIONAL_TRUST
    delta: 350000   # Restore $3,500 (50% of Day 4 loss)
    schedule:
      type: OneTime
      tick: 320

  - type: CollateralAdjustment
    agent: COMMUNITY_FIRST
    delta: 250000   # Restore $2,500
    schedule:
      type: OneTime
      tick: 320

  # Afternoon (tick 340): Deadline requirements moderately relaxed
  - type: DeadlineWindowChange
    min_ticks_multiplier: 1.1  # Loosen by 10% (vs 1.5× in severe)
    max_ticks_multiplier: 1.1
    schedule:
      type: OneTime
      tick: 340

  # ========================================================================
  # DAY 8 (Ticks 350-399): Operations Normalize
  # ========================================================================

  # Morning (tick 355): REGIONAL_TRUST full operations restored
  - type: AgentArrivalRateChange
    agent: REGIONAL_TRUST
    multiplier: 1.0  # Full capacity
    schedule:
      type: OneTime
      tick: 355

  # Ticks 360-375: Counterparty relationships rebuild
  - type: CounterpartyWeightChange
    agent: METRO_CENTRAL
    counterparty: REGIONAL_TRUST
    new_weight: 0.25  # Back to original
    schedule:
      type: OneTime
      tick: 360

  - type: CounterpartyWeightChange
    agent: CORRESPONDENT_HUB
    counterparty: REGIONAL_TRUST
    new_weight: 0.25
    schedule:
      type: OneTime
      tick: 365

  - type: CounterpartyWeightChange
    agent: MOMENTUM_CAPITAL
    counterparty: REGIONAL_TRUST
    new_weight: 0.25
    schedule:
      type: OneTime
      tick: 370

  - type: CounterpartyWeightChange
    agent: COMMUNITY_FIRST
    counterparty: REGIONAL_TRUST
    new_weight: 0.25
    schedule:
      type: OneTime
      tick: 375

  # Afternoon (tick 390): Further collateral restoration
  - type: CollateralAdjustment
    agent: METRO_CENTRAL
    delta: 700000   # Restore $7,000 (70% of Day 4 loss)
    schedule:
      type: OneTime
      tick: 390

  - type: CollateralAdjustment
    agent: MOMENTUM_CAPITAL
    delta: 600000   # Restore $6,000
    schedule:
      type: OneTime
      tick: 390

  - type: CollateralAdjustment
    agent: CORRESPONDENT_HUB
    delta: 600000   # Restore $6,000
    schedule:
      type: OneTime
      tick: 390

  # ========================================================================
  # DAY 9 (Ticks 400-449): New Equilibrium Established
  # ========================================================================

  # Morning (tick 405): New regulatory framework (sustainable baseline)
  - type: DeadlineWindowChange
    min_ticks_multiplier: 1.05  # Slightly longer than pre-crisis (new normal)
    max_ticks_multiplier: 1.05
    schedule:
      type: OneTime
      tick: 405

  # Midday (tick 425): Final collateral adjustments (restore to new equilibrium)
  - type: CollateralAdjustment
    agent: REGIONAL_TRUST
    delta: 200000   # Restore remaining $2,000 (partial - new prudent level)
    schedule:
      type: OneTime
      tick: 425

  - type: CollateralAdjustment
    agent: COMMUNITY_FIRST
    delta: 150000   # Restore remaining $1,500
    schedule:
      type: OneTime
      tick: 425

  # ========================================================================
  # DAY 10 (Ticks 450-499): Successful Stress Test
  # ========================================================================

  # Morning (tick 455): Coordinated large payments (demonstrate resilience)
  - type: CustomTransactionArrival
    from_agent: METRO_CENTRAL
    to_agent: CORRESPONDENT_HUB
    amount: 2500000   # $25,000 (smaller than Day 3 to show improvement)
    priority: 7
    deadline: 25
    is_divisible: true
    schedule:
      type: OneTime
      tick: 455

  - type: CustomTransactionArrival
    from_agent: CORRESPONDENT_HUB
    to_agent: REGIONAL_TRUST
    amount: 2000000   # $20,000
    priority: 7
    deadline: 25
    is_divisible: true
    schedule:
      type: OneTime
      tick: 455

  - type: CustomTransactionArrival
    from_agent: REGIONAL_TRUST
    to_agent: MOMENTUM_CAPITAL
    amount: 1800000   # $18,000
    priority: 7
    deadline: 25
    is_divisible: true
    schedule:
      type: OneTime
      tick: 458

  # Midday (tick 470): Moderate activity surge (system handles well)
  - type: GlobalArrivalRateChange
    multiplier: 1.3  # Modest surge
    schedule:
      type: OneTime
      tick: 470

  # Afternoon (tick 485): System stable
  - type: GlobalArrivalRateChange
    multiplier: 1.0
    schedule:
      type: OneTime
      tick: 485

# ============================================================================
# LSM CONFIGURATION - Enhanced for crisis resolution
# ============================================================================

lsm_config:
  enable_bilateral: true
  enable_cycles: true
  max_cycle_length: 5
  max_cycles_per_tick: 8  # Slightly higher to help resolve gridlock

# ============================================================================
# COST CONFIGURATION - Realistic (10× lower penalties than severe version)
# ============================================================================

cost_rates:
  delay_cost_per_tick_per_cent: 0.00005    # Very low delay cost
  overdraft_bps_per_tick: 0.5              # Modest overdraft cost (vs 1.0)
  collateral_cost_per_tick_bps: 0.0003     # Lower collateral cost
  eod_penalty_per_transaction: 50000       # $500 EOD penalty (vs $5,000)
  deadline_penalty: 25000                  # $250 deadline penalty (vs $2,500)
  overdue_delay_multiplier: 3.0            # Moderate (vs 5.0)
  split_friction_cost: 5000                # $50 split cost (vs $75)

# ============================================================================
# EXPECTED DYNAMICS - Realistic Crisis with Resolution
# ============================================================================
#
# EVENT SUMMARY BY DAY:
#
# Day 1-2: Baseline (0 events)
#   - Normal settlement patterns
#   - Low costs, high settlement rates
#
# Day 3: Market Volatility (3 events)
#   - GlobalArrivalRateChange: 1.4× → 1.1× (contained surge)
#   - CustomTransactionArrival: 1 large payment ($30k)
#   - Moderate stress, LSM helps resolve
#
# Day 4: Regulatory Adjustments (7 events)
#   - CollateralAdjustment: 5 haircuts totaling -$38k (20% cuts, not 50%)
#   - DeadlineWindowChange: Moderate tightening (0.85×)
#   - System remains functional with slightly higher costs
#
# Day 5: Operational Issues (5 events)
#   - AgentArrivalRateChange: REGIONAL at 30% capacity (not 0.1%)
#   - CounterpartyWeightChange: 4 prudent exposure reductions (0.15, not 0.05)
#   - Contained stress, no system-wide panic
#
# Day 6: Swift Intervention (4 events)
#   - CustomTransactionArrival: $30k to REGIONAL, $15k to COMMUNITY
#   - GlobalArrivalRateChange: Brief 1.3× surge, quickly resolved
#   - Central bank support prevents contagion
#
# Day 7: Recovery Begins (4 events)
#   - AgentArrivalRateChange: REGIONAL to 70% capacity
#   - CollateralAdjustment: Partial restorations (+$6k)
#   - DeadlineWindowChange: Modest relaxation (1.1×)
#   - Costs declining, settlement improving
#
# Day 8: Operations Normalize (8 events)
#   - AgentArrivalRateChange: REGIONAL to 100%
#   - CounterpartyWeightChange: 4 relationships fully restored
#   - CollateralAdjustment: Further restorations (+$19k)
#   - Near-normal operations resumed
#
# Day 9: New Equilibrium (4 events)
#   - DeadlineWindowChange: Sustainable new normal (1.05×)
#   - CollateralAdjustment: Final adjustments (+$3.5k)
#   - System operating at new, more resilient baseline
#
# Day 10: Resilience Demonstrated (5 events)
#   - CustomTransactionArrival: 3 large payments (smaller than Day 3)
#   - GlobalArrivalRateChange: 1.3× surge → 1.0×
#   - System handles stress easily, proving crisis resolved
#
# TOTAL EVENTS: 40 scenario events across 10 days
#
# EVENT TYPE USAGE:
# - CustomTransactionArrival: 7 events (stress tests + interventions)
# - CollateralAdjustment: 12 events (haircuts + gradual restorations)
# - GlobalArrivalRateChange: 9 events (volatility + normalizations)
# - AgentArrivalRateChange: 3 events (degradation + recovery)
# - CounterpartyWeightChange: 8 events (risk management)
# - DeadlineWindowChange: 3 events (policy adjustments)
#
# KEY DIFFERENCES FROM SEVERE VERSION:
#
# 1. SUSTAINABLE STRESS LEVELS:
#    - Opening balances 2.5-3× higher ($150k-$350k vs $50k-$140k)
#    - Credit limits 5× higher ($25k-$50k vs $5k-$10k)
#    - Payment volumes reduced 20-30%
#    → Result: Banks can actually absorb shocks
#
# 2. REALISTIC PENALTIES:
#    - Deadline penalty: $250 (vs $2,500) - 10× lower
#    - EOD penalty: $500 (vs $5,000) - 10× lower
#    - Overdue multiplier: 3× (vs 5×)
#    → Result: Costs sting but don't create death spiral
#
# 3. MODERATE REGULATORY RESPONSES:
#    - Collateral haircuts: 20% (vs 50%)
#    - Deadline tightening: 0.85× (vs 0.4×)
#    - Activity surges: 1.4× (vs 2.0×)
#    → Result: Realistic stress testing, not torture testing
#
# 4. EFFECTIVE INTERVENTIONS:
#    - Central bank support arrives Day 6 (vs Day 6 in severe, but more targeted)
#    - REGIONAL gets $30k directly (targeted support)
#    - Gradual collateral restoration over Days 7-9
#    → Result: Clear crisis resolution pathway
#
# 5. DEMONSTRATED RECOVERY:
#    - Day 7: Costs declining, operations improving
#    - Day 8: Relationships rebuilt, near-normal function
#    - Day 9: New sustainable equilibrium
#    - Day 10: Stress test passes easily
#    → Result: Crisis emergence AND resolution visible
#
# 6. REALISTIC CRISIS PATTERN:
#    - Days 1-2: Normal ($X costs/day)
#    - Days 3-5: Stress ($2-3X costs/day, manageable)
#    - Day 6: Peak intervention ($4X costs/day)
#    - Days 7-8: Recovery ($1.5-2X costs/day)
#    - Days 9-10: New normal ($1.2X costs/day)
#    → Result: U-shaped recovery, not L-shaped collapse
#
# 7. POLICY COMPARISON FEASIBILITY:
#    All agents face identical, manageable shocks, enabling analysis:
#    - Which policy minimizes Days 3-5 costs?
#    - Which recovers fastest (Days 6-8)?
#    - Which maintains best relationships during stress?
#    - Which optimizes Day 10 performance?
#
# USAGE:
# ======
#
# # Run realistic crisis scenario
# payment-sim run \
#   --config examples/configs/ten_day_realistic_crisis_scenario.yaml \
#   --persist \
#   --db-path realistic_crisis.db \
#   --verbose
#
# # Compare with severe version
# payment-sim run \
#   --config examples/configs/ten_day_crisis_scenario.yaml \
#   --persist \
#   --db-path severe_crisis.db \
#   --verbose
#
# # Replay specific day (e.g., Day 6 intervention)
# payment-sim replay \
#   --simulation-id <id> \
#   --config examples/configs/ten_day_realistic_crisis_scenario.yaml \
#   --from-tick 250 \
#   --to-tick 299 \
#   --verbose
#
# # Analyze crisis progression
# SELECT tick, event_type, details
# FROM simulation_events
# WHERE event_type = 'ScenarioEventExecuted'
# ORDER BY tick;
