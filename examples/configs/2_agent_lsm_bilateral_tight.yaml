# 2-Agent LSM Bilateral - Tight Liquidity to Force Queue 2 Usage
#
# This scenario forces Queue 2 queueing by:
# 1. Very low opening balances ($5k each)
# 2. Zero credit limits (no overdraft escape valve)
# 3. Significant transaction volumes
# 4. Front-loaded arrivals (many transactions arrive early)

simulation:
  ticks_per_day: 10
  num_days: 1
  rng_seed: 42

agents:
  - id: "BANK_A"
    opening_balance: 500000          # $5,000 - Very tight
    credit_limit: 0                  # NO CREDIT - forces pure liquidity recycling
    policy:
      type: "Fifo"                   # Submits everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 5.0             # ~50 transactions/day (high volume)
      amount_distribution:
        type: "LogNormal"
        mean: 10.0                   # Median ~$220 (smaller amounts for volume)
        std_dev: 0.8
      counterparty_weights:
        BANK_B: 1.0
      deadline_range: [5, 10]
      priority: 5
      divisible: false

  - id: "BANK_B"
    opening_balance: 500000          # $5,000 - Very tight
    credit_limit: 0                  # NO CREDIT - forces pure liquidity recycling
    policy:
      type: "Fifo"                   # Submits everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 5.0             # ~50 transactions/day (high volume)
      amount_distribution:
        type: "LogNormal"
        mean: 10.0                   # Median ~$220
        std_dev: 0.8
      counterparty_weights:
        BANK_A: 1.0                  # Perfect bilateral flow
      deadline_range: [5, 10]
      priority: 5
      divisible: false

lsm_config:
  enable_bilateral: true
  enable_cycles: false
  max_cycle_length: 3
  max_cycles_per_tick: 10

cost_rates:
  overdraft_bps_per_tick: 2.0
  delay_cost_per_tick_per_cent: 0.0004
  collateral_cost_per_tick_bps: 0.0012
  eod_penalty_per_transaction: 100000
  deadline_penalty: 50000
  split_friction_cost: 2500

# ============================================================================
# EXPECTED DYNAMICS
# ============================================================================
#
# With $5k opening balance each and ~$11k expected outflow:
# - Early transactions settle using opening balance
# - As balances deplete, transactions queue in Queue 2
# - Inflows from counterparty enable some settlement (recycling)
# - BUT with zero credit, any timing mismatch creates Queue 2 backlog
# - LSM bilateral offsetting can settle A↔B pairs with net liquidity
#
# Example:
# - Tick 3: A has $1k left, owes $5k to B (4 transactions queued in Q2)
# - Tick 3: B has $1k left, owes $4k to A (3 transactions queued in Q2)
# - LSM: Settles both directions, net $1k A→B, saves $4k gross liquidity
