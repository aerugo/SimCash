# 5-Agent Collateral Pressure Simulation
#
# Configuration: 5 banks with different policies designed to create liquidity pressure
# - BANK_A: FIFO, moderate liquidity, high transaction volume
# - BANK_B: Deadline policy (conservative), low liquidity - pressure to post collateral
# - BANK_C: LiquidityAware (tight buffer), constrained - strategic collateral use
# - BANK_D: FIFO, very low liquidity, high volume - MOST PRESSURE
# - BANK_E: LiquidityAware (balanced), medium liquidity - reference bank
#
# Scenario design:
# - Lower balances relative to transaction volumes to create stress
# - Higher transaction rates and amounts
# - Significant credit limits make collateral posting economically viable
# - 20 ticks/day over 2 days = 40 total ticks

simulation:
  ticks_per_day: 2
  num_days: 2
  rng_seed: 42  # Change for different random scenarios

# ============================================================================
# AGENTS: 5 banks configured to create collateral pressure
# ============================================================================

agents:
  # ==========================================================================
  # BANK_A: FIFO - Moderate Liquidity, High Volume
  # Strategy: Submit all transactions immediately
  # Pressure: High transaction volume will strain moderate liquidity
  # ==========================================================================

  - id: "BANK_A_FIFO"
    opening_balance: 3000000    # $30,000 - Moderate starting liquidity
    credit_limit: 2500000       # $25,000 credit available (significant)
    policy:
      type: "Fifo"
    arrival_config:
      rate_per_tick: 1.0        # ~20 transactions/day (high volume)
      amount_distribution:
        type: "Uniform"
        min: 50000              # $500
        max: 500000             # $5,000
      counterparty_weights:
        BANK_B_DEADLINE: 0.25
        BANK_C_LIQUIDITY_TIGHT: 0.25
        BANK_D_FIFO_CONSTRAINED: 0.25
        BANK_E_LIQUIDITY_BALANCED: 0.25
      deadline_range: [5,10]  # Moderate deadlines
      priority: 5
      divisible: false

  # ==========================================================================
  # BANK_B: Deadline Policy - Low Liquidity
  # Strategy: Hold payments until near deadline
  # Pressure: Low liquidity + holding strategy = need for collateral
  # ==========================================================================

  - id: "BANK_B_DEADLINE"
    opening_balance: 2000000    # $20,000 - Low liquidity
    credit_limit: 1500000       # $15,000 credit
    policy:
      type: "Deadline"
      urgency_threshold: 3      # Submit 3 ticks before deadline
    arrival_config:
      rate_per_tick: 0.9        # ~18 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 40000              # $400
        max: 450000             # $4,500
      counterparty_weights:
        BANK_A_FIFO: 0.30
        BANK_C_LIQUIDITY_TIGHT: 0.20
        BANK_D_FIFO_CONSTRAINED: 0.20
        BANK_E_LIQUIDITY_BALANCED: 0.30
      deadline_range: [5,10]  # Tighter deadlines
      priority: 5
      divisible: false

  # ==========================================================================
  # BANK_C: LiquidityAware - Tight Buffer, Constrained
  # Strategy: Preserve liquidity buffer, strategic about submissions
  # Pressure: Tight buffer policy + medium liquidity = collateral decisions
  # ==========================================================================

  - id: "BANK_C_LIQUIDITY_TIGHT"
    opening_balance: 2500000    # $25,000 - Constrained liquidity
    credit_limit: 2000000       # $20,000 credit
    policy:
      type: "LiquidityAware"
      target_buffer: 100000     # $1,000 buffer (tight)
      urgency_threshold: 5
    arrival_config:
      rate_per_tick: 0.85       # ~17 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 50000              # $500
        max: 400000             # $4,000
      counterparty_weights:
        BANK_A_FIFO: 0.25
        BANK_B_DEADLINE: 0.25
        BANK_D_FIFO_CONSTRAINED: 0.25
        BANK_E_LIQUIDITY_BALANCED: 0.25
      deadline_range: [5,10]
      priority: 5
      divisible: false

  # ==========================================================================
  # BANK_D: FIFO - Very Low Liquidity, High Volume
  # Strategy: Submit all immediately despite low liquidity
  # Pressure: HIGHEST PRESSURE - very low balance + high volume + FIFO
  # ==========================================================================

  - id: "BANK_D_FIFO_CONSTRAINED"
    opening_balance: 1500000    # $15,000 - Very low liquidity
    credit_limit: 2000000       # $20,000 credit (larger than balance!)
    policy:
      type: "Fifo"
    arrival_config:
      rate_per_tick: 1.2        # ~24 transactions/day (highest volume)
      amount_distribution:
        type: "Uniform"
        min: 30000              # $300
        max: 400000             # $4,000
      counterparty_weights:
        BANK_A_FIFO: 0.30
        BANK_B_DEADLINE: 0.25
        BANK_C_LIQUIDITY_TIGHT: 0.20
        BANK_E_LIQUIDITY_BALANCED: 0.25
      deadline_range: [5,10]  # Tight deadlines
      priority: 5
      divisible: false

  # ==========================================================================
  # BANK_E: LiquidityAware - Balanced, Medium Liquidity
  # Strategy: Balanced approach with moderate buffer
  # Pressure: Reference bank - some pressure but manageable
  # ==========================================================================

  - id: "BANK_E_LIQUIDITY_BALANCED"
    opening_balance: 3500000    # $35,000 - Best liquidity of the group
    credit_limit: 1500000       # $15,000 credit
    policy:
      type: "LiquidityAware"
      target_buffer: 200000     # $2,000 buffer (balanced)
      urgency_threshold: 5
    arrival_config:
      rate_per_tick: 0.8        # ~16 transactions/day (moderate volume)
      amount_distribution:
        type: "Uniform"
        min: 50000              # $500
        max: 500000             # $5,000
      counterparty_weights:
        BANK_A_FIFO: 0.25
        BANK_B_DEADLINE: 0.25
        BANK_C_LIQUIDITY_TIGHT: 0.25
        BANK_D_FIFO_CONSTRAINED: 0.25
      deadline_range: [5,10]  # More relaxed deadlines
      priority: 5
      divisible: false

# ============================================================================
# LSM CONFIGURATION
# Enable bilateral offsetting and cycle detection to resolve gridlocks
# ============================================================================

lsm_config:
  bilateral_offsetting: true
  cycle_detection: true
  max_iterations: 5

# ============================================================================
# COST CONFIGURATION
# Higher costs to incentivize collateral posting over overdrafts
# ============================================================================

cost_rates:
  overdraft_bps_per_tick: 15          # 15 basis points per tick (higher to encourage collateral)
  delay_cost_per_tick_per_cent: 2     # $0.02 per cent per tick in queue (doubled)
  eod_penalty_per_transaction: 1000000  # $10,000 penalty for unsettled at end-of-day
  deadline_penalty: 500000            # $5,000 penalty for missing deadline
  split_friction_cost: 10000          # $100 cost to split a transaction
