# 2-Agent LSM Bilateral Offsetting Scenario
#
# This scenario demonstrates bilateral offsetting (A↔B) where:
# 1. Bank A sends $100k to Bank B (queued in Queue 2 due to insufficient liquidity)
# 2. Bank B sends $80k to Bank A (queued in Queue 2 due to insufficient liquidity)
# 3. LSM detects bilateral pair and settles both with net $20k flow A→B
#
# Design rationale:
# - FIFO policies ensure immediate submission to Queue 2
# - Very low opening balances force Queue 2 queueing
# - Perfect bilateral flow (A↔B) creates offsetting opportunity
# - LSM reduces liquidity requirement from $180k gross to $20k net

simulation:
  ticks_per_day: 10
  num_days: 1
  rng_seed: 42

# ============================================================================
# AGENT A - Sends to B, receives from B
# ============================================================================

agents:
  - id: "BANK_A"
    opening_balance: 3000000         # $30,000 - Insufficient for all outflows
    credit_limit: 5000000            # $50,000 credit limit
    policy:
      type: "Fifo"                   # Submits everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 3.0             # ~30 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 11.5                   # Median ~$1,000
        std_dev: 0.5
      counterparty_weights:
        BANK_B: 1.0                  # All payments to B
      deadline_range: [5, 10]
      priority: 5
      divisible: false

# ============================================================================
# AGENT B - Sends to A, receives from A
# ============================================================================

  - id: "BANK_B"
    opening_balance: 3000000         # $30,000 - Insufficient for all outflows
    credit_limit: 5000000            # $50,000 credit limit
    policy:
      type: "Fifo"                   # Submits everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 2.5             # ~25 transactions/day (slightly less than A)
      amount_distribution:
        type: "LogNormal"
        mean: 11.5                   # Median ~$1,000
        std_dev: 0.5
      counterparty_weights:
        BANK_A: 1.0                  # All payments to A (creates bilateral flow)
      deadline_range: [5, 10]
      priority: 5
      divisible: false

# ============================================================================
# LSM CONFIGURATION
# ============================================================================

lsm_config:
  enable_bilateral: true             # Enable bilateral offsetting
  enable_cycles: false               # Disable cycles (not needed for 2-agent)
  max_cycle_length: 3
  max_cycles_per_tick: 5

# ============================================================================
# COST CONFIGURATION
# ============================================================================

cost_rates:
  overdraft_bps_per_tick: 2.0
  delay_cost_per_tick_per_cent: 0.0004
  collateral_cost_per_tick_bps: 0.0012
  eod_penalty_per_transaction: 100000
  deadline_penalty: 50000
  split_friction_cost: 2500

# ============================================================================
# EXPECTED DYNAMICS
# ============================================================================
#
# ✅ HOW BILATERAL OFFSETTING WORKS:
#
# 1. Both banks submit transactions to Queue 2 immediately (FIFO policy)
#
# 2. Early ticks: Some transactions settle using opening balances
#    - Bank A settles first few A→B payments (using $30k balance)
#    - Bank B settles first few B→A payments (using $30k balance)
#
# 3. Mid-day: Queue 2 fills up as balances deplete
#    - More A→B transactions queue (insufficient liquidity)
#    - More B→A transactions queue (insufficient liquidity)
#
# 4. LSM bilateral offsetting activates
#    - Detects A↔B bilateral pair in Queue 2
#    - Calculates: A owes B $X, B owes A $Y
#    - Settles both directions with net flow of |X-Y|
#    - Example: A→B $50k queued, B→A $40k queued
#      → Both settle, net $10k A→B, saves $40k gross liquidity
#
# Expected metrics:
# - total_lsm_releases > 0
# - bilateral_offsets > 0
# - cycles_settled = 0 (only 2 agents, no cycles possible)
# - High settlement rate despite low opening balances
