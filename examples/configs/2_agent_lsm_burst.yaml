# 2-Agent LSM with Burst Arrivals - Forces Queue 2 Queueing
#
# Strategy to trigger LSM:
# 1. Concentrate ALL transaction arrivals in early ticks (burst pattern)
# 2. Extremely low opening balances ($500 each)
# 3. Zero credit limits (no escape valve)
# 4. Many large transactions arriving simultaneously
# 5. FIFO policy submits everything to Queue 2 immediately
#
# Expected behavior:
# - Ticks 1-3: Burst of 40+ transactions arrive simultaneously
# - Both banks try to send ~$10k but only have $500
# - Queue 2 fills with transactions awaiting liquidity
# - LSM bilateral offsetting detects A↔B pairs and settles with net flow
# - Later ticks: Remaining queue drains via recycled liquidity

simulation:
  ticks_per_day: 10
  num_days: 1
  rng_seed: 42

agents:
  - id: "BANK_A"
    opening_balance: 50000           # Only $500 - VERY tight
    credit_limit: 0                  # NO CREDIT - pure recycling only
    policy:
      type: "Fifo"                   # Submit everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 10.0            # Base rate (will be amplified by time windows)
      amount_distribution:
        type: "LogNormal"
        mean: 10.0                   # Median ~$220
        std_dev: 0.5
      counterparty_weights:
        BANK_B: 1.0
      deadline_range: [5, 10]
      priority: 5
      divisible: false
      # Time windows: Concentrate 90% of volume in first 3 ticks
      time_windows:
        - tick_range: [0, 3]
          rate_multiplier: 5.0       # 50 tx/tick in burst period
        - tick_range: [4, 10]
          rate_multiplier: 0.1       # 1 tx/tick in tail period

  - id: "BANK_B"
    opening_balance: 50000           # Only $500 - VERY tight
    credit_limit: 0                  # NO CREDIT - pure recycling only
    policy:
      type: "Fifo"                   # Submit everything to Queue 2 immediately
    arrival_config:
      rate_per_tick: 10.0            # Base rate (amplified by time windows)
      amount_distribution:
        type: "LogNormal"
        mean: 10.0                   # Median ~$220
        std_dev: 0.5
      counterparty_weights:
        BANK_A: 1.0                  # Perfect bilateral flow
      deadline_range: [5, 10]
      priority: 5
      divisible: false
      # Time windows: Concentrate 90% of volume in first 3 ticks
      time_windows:
        - tick_range: [0, 3]
          rate_multiplier: 5.0       # 50 tx/tick in burst period
        - tick_range: [4, 10]
          rate_multiplier: 0.1       # 1 tx/tick in tail period

lsm_config:
  enable_bilateral: true
  enable_cycles: false
  max_cycle_length: 3
  max_cycles_per_tick: 10

cost_rates:
  overdraft_bps_per_tick: 2.0
  delay_cost_per_tick_per_cent: 0.0004
  collateral_cost_per_tick_bps: 0.0012
  eod_penalty_per_transaction: 100000
  deadline_penalty: 50000
  split_friction_cost: 2500

# ============================================================================
# EXPECTED DYNAMICS
# ============================================================================
#
# Tick 0-3 (Burst Period):
# - Both banks receive ~50 transactions each (~$11k total value)
# - FIFO policies submit all to Queue 2 immediately
# - Each bank only has $500 balance, needs $11k
# - First few transactions settle using opening balance
# - Remaining ~45+ transactions queue in Queue 2 (insufficient liquidity)
# - LSM detects massive bilateral queue:
#   * A→B: ~45 transactions ($10.5k)
#   * B→A: ~45 transactions ($10.5k)
# - LSM settles both directions with net $0-100 flow
# - Liquidity recycling: settlements provide liquidity for more settlements
#
# Tick 4-10 (Tail Period):
# - Low arrival rate (1 tx/tick)
# - Any remaining queue drains via recycled liquidity
#
# Expected metrics:
# - total_lsm_releases > 0 (bilateral offsetting activates)
# - bilateral_offsets > 0
# - Queue 2 peak size: 80+ transactions (during burst)
# - Settlement rate: ~95-100% (LSM enables settlement despite low balances)
