# 5-Agent LSM & Collateral Stress Scenario with Sophisticated JSON Policies
#
# Configuration: 5 banks with distinct JSON decision tree policies, engineered to trigger:
# 1. Collateral usage (multiple banks severely undercapitalized)
# 2. LSM activation (circular flows + severe liquidity constraints force queueing)
# 3. Bilateral offsetting (heavy bilateral flows between multiple pairs)
#
# Design rationale:
# - Only 25 ticks/day (each tick â‰ˆ 20 minutes), so arrival rates are higher
# - 2 days total = 50 ticks for pattern development
# - Cost rates scaled 8x higher per tick (vs 200-tick scenarios) to maintain daily costs
# - ALL banks severely undercapitalized â†’ MULTIPLE banks will use credit limits
# - Circular counterparty weights create cycle opportunities for LSM
# - Sophisticated policies demonstrate different strategic approaches

simulation:
  ticks_per_day: 25
  num_days: 2
  rng_seed: 42

# ============================================================================
# AGENT 1: CAUTIOUS_PRESERVER (Cautious Liquidity Preserver Policy)
# Strategy: Ultra-conservative, maintains 2.5x buffer, avoids credit except emergencies
# ============================================================================

agents:
  - id: "CAUTIOUS_PRESERVER"
    opening_balance: 10000000        # $100,000 - Constrained
    credit_limit: 20000000           # $200,000 credit (reluctantly used)
    policy:
      type: "FromJson"
      json_path: "backend/policies/cautious_liquidity_preserver.json"
    arrival_config:
      rate_per_tick: 3.5             # ~87 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 10.8                   # Median ~$500
        std_dev: 0.9
      counterparty_weights:
        AGGRESSIVE_TRADER: 0.30      # Heavy bilateral with aggressive trader
        DEADLINE_TRADER: 0.25
        SMART_SPLITTER: 0.25
        COST_OPTIMIZER: 0.20
      deadline_range: [8, 18]        # Moderate deadlines
      priority: 5
      divisible: false

# ============================================================================
# AGENT 2: AGGRESSIVE_TRADER (Aggressive Market Maker Policy)
# Strategy: High-velocity release, uses credit liberally, monitors congestion
# ============================================================================

  - id: "AGGRESSIVE_TRADER"
    opening_balance: 8000000         # $80,000 - Very constrained
    credit_limit: 35000000           # $350,000 credit (aggressive usage expected)
    policy:
      type: "FromJson"
      json_path: "backend/policies/aggressive_market_maker.json"
    arrival_config:
      rate_per_tick: 5.5             # ~137 transactions/day (highest volume)
      amount_distribution:
        type: "LogNormal"
        mean: 11.2                   # Median ~$750
        std_dev: 1.1
      counterparty_weights:
        CAUTIOUS_PRESERVER: 0.35     # Heavy bilateral back to cautious
        DEADLINE_TRADER: 0.25        # Creates cycle opportunities
        SMART_SPLITTER: 0.20
        COST_OPTIMIZER: 0.20
      deadline_range: [6, 16]        # Tighter deadlines
      priority: 6
      divisible: false

# ============================================================================
# AGENT 3: DEADLINE_TRADER (Deadline-Driven Trader Policy)
# Strategy: Holds until urgent, then uses credit liberally to meet deadlines
# ðŸ”´ LIQUIDITY CONSTRAINED: Low balance + holding strategy â†’ WILL USE COLLATERAL
# ============================================================================

  - id: "DEADLINE_TRADER"
    opening_balance: 9000000         # $90,000 - Low
    credit_limit: 40000000           # $400,000 credit (willing to use)
    policy:
      type: "FromJson"
      json_path: "backend/policies/deadline_driven_trader.json"
    arrival_config:
      rate_per_tick: 5.0             # ~125 transactions/day (high volume)
      amount_distribution:
        type: "LogNormal"
        mean: 11.0                   # Median ~$600
        std_dev: 1.2                 # High variance
      counterparty_weights:
        AGGRESSIVE_TRADER: 0.30
        COST_OPTIMIZER: 0.30         # Creates cycle: DEADLINEâ†’COST_OPTâ†’CAUTIOUSâ†’AGGRESSIVEâ†’DEADLINE
        CAUTIOUS_PRESERVER: 0.25
        SMART_SPLITTER: 0.15
      deadline_range: [5, 15]        # Tight deadlines
      priority: 7
      divisible: false

# ============================================================================
# AGENT 4: SMART_SPLITTER (Smart Splitter Policy)
# Strategy: Tactically splits large payments, compares split friction vs other costs
# ============================================================================

  - id: "SMART_SPLITTER"
    opening_balance: 11000000        # $110,000 - Constrained
    credit_limit: 25000000           # $250,000 credit
    policy:
      type: "FromJson"
      json_path: "backend/policies/smart_splitter.json"
    arrival_config:
      rate_per_tick: 4.0             # ~100 transactions/day
      amount_distribution:
        type: "Uniform"
        min: 50000                   # $500 (some large enough to split)
        max: 800000                  # $8,000
      counterparty_weights:
        DEADLINE_TRADER: 0.30
        CAUTIOUS_PRESERVER: 0.30     # Completes cycle: SPLITTERâ†’CAUTIOUSâ†’AGGRESSIVEâ†’SPLITTER
        COST_OPTIMIZER: 0.25
        AGGRESSIVE_TRADER: 0.15
      deadline_range: [8, 18]
      priority: 5
      divisible: true                # Splitting enabled

# ============================================================================
# AGENT 5: COST_OPTIMIZER (Balanced Cost Optimizer Policy)
# Strategy: Holistic cost minimization across all dimensions, time-adaptive
# ============================================================================

  - id: "COST_OPTIMIZER"
    opening_balance: 12000000        # $120,000 - Moderate
    credit_limit: 30000000           # $300,000 credit
    policy:
      type: "FromJson"
      json_path: "backend/policies/balanced_cost_optimizer.json"
    arrival_config:
      rate_per_tick: 4.5             # ~112 transactions/day
      amount_distribution:
        type: "LogNormal"
        mean: 11.3                   # Median ~$800
        std_dev: 1.0
      counterparty_weights:
        CAUTIOUS_PRESERVER: 0.30     # Creates cycle: OPTIMIZERâ†’CAUTIOUSâ†’AGGRESSIVEâ†’DEADLINEâ†’OPTIMIZER
        AGGRESSIVE_TRADER: 0.25
        DEADLINE_TRADER: 0.25
        SMART_SPLITTER: 0.20
      deadline_range: [10, 20]
      priority: 6
      divisible: false

# ============================================================================
# LSM CONFIGURATION
# Enable both bilateral offsetting and cycle detection
# ============================================================================

lsm_config:
  enable_bilateral: true             # Enable Aâ†”B bilateral offsetting
  enable_cycles: true                # Enable cycle detection (Aâ†’Bâ†’Câ†’A)
  max_cycle_length: 4                # Detect cycles up to 4 banks
  max_cycles_per_tick: 8             # Settle up to 8 cycles per tick

# ============================================================================
# COST CONFIGURATION
# Scaled 8x higher per tick (25 ticks/day vs typical 200 ticks/day)
# This maintains similar daily cost totals while reflecting longer tick duration
# ============================================================================

cost_rates:
  overdraft_bps_per_tick: 4.0                   # 4.0 bp/tick (each tick â‰ˆ 20 min)
  delay_cost_per_tick_per_cent: 0.0008         # $0.008 per $100 per tick
  collateral_cost_per_tick_bps: 0.0024         # 0.24 bp/tick for collateral
  eod_penalty_per_transaction: 500000           # $5,000 penalty for unsettled at EOD
  deadline_penalty: 250000                      # $2,500 penalty for missing deadline
  split_friction_cost: 5000                     # $50 cost per split

# ============================================================================
# EXPECTED DYNAMICS
# ============================================================================
#
# âœ… COLLATERAL USAGE TRIGGERS:
# - AGGRESSIVE_TRADER has opening balance $80K but expects ~$103K outflow/day
#   (5.5 tx/tick * 25 ticks * $750 avg = ~$103K)
# - DEADLINE_TRADER has $90K balance with ~$75K/day outflow (5 tx/tick * $600 avg)
# - CAUTIOUS_PRESERVER has $100K but expects ~$44K outflow (will hold aggressively)
# - SMART_SPLITTER has $110K balance with ~$170K/day outflow (4 tx/tick * $1700 avg range)
# - COST_OPTIMIZER has $120K balance with ~$90K/day outflow
# - ALL banks severely undercapitalized â†’ MULTIPLE banks will use credit limits
# - Different policies will approach collateral differently:
#   * CAUTIOUS: Emergency-only reactive collateral
#   * AGGRESSIVE: Proactive collateral posting when gap exists
#   * DEADLINE: Strategic collateral in late day
#   * SPLITTER: Late-day reactive collateral
#   * OPTIMIZER: Cost-based collateral decisions
#
# âœ… LSM ACTIVATION TRIGGERS:
# 1. Bilateral Offsetting Opportunities:
#    - CAUTIOUS â†” AGGRESSIVE: 30% and 35% mutual weights = heavy bilateral flows
#    - CAUTIOUS â†” SPLITTER: 25% and 30% = asymmetric bilateral
#    - DEADLINE â†” AGGRESSIVE: 30% and 25% = moderate bilateral
#
# 2. Cycle Detection Opportunities:
#    - 3-cycle: CAUTIOUS(30%)â†’AGGRESSIVE(35%)â†’DEADLINE(30%)â†’CAUTIOUS
#    - 3-cycle: SPLITTER(30%)â†’CAUTIOUS(30%)â†’AGGRESSIVE(20%)â†’SPLITTER
#    - 4-cycle: OPTIMIZER(30%)â†’CAUTIOUS(30%)â†’AGGRESSIVE(25%)â†’DEADLINE(30%)â†’OPTIMIZER
#    - 5-cycle: Full system cycle touching all agents
#
# 3. Severe Liquidity Constraints Force Queueing:
#    - Total opening balance: $50K across 5 banks
#    - Expected total daily outflow: ~$485K (heavily imbalanced)
#    - Insufficient gross liquidity â†’ transactions WILL queue in Queue 2
#    - Policies will hold strategically, increasing Queue 2 pressure
#    - LSM MUST activate to resolve gridlock via offsetting and cycles
#
# With LSM enabled, these circular flows should settle with minimal net liquidity,
# preventing complete gridlock despite severe undercapitalization. Each policy's
# distinct strategy will create diverse timing patterns that test LSM efficacy.
#
# âœ… POLICY DIVERSITY (All Sophisticated JSON Decision Trees):
#
# 1. CAUTIOUS_PRESERVER (cautious_liquidity_preserver.json):
#    - Maintains 2.5x buffer before releasing
#    - Emergency-only collateral posting (>85% day progress + gap)
#    - Conservative early day, cautiously releases late day
#    - Compares penalty vs credit costs carefully
#
# 2. AGGRESSIVE_TRADER (aggressive_market_maker.json):
#    - Near-FIFO release when system not congested
#    - Monitors system congestion (holds trivial when overloaded)
#    - Proactive collateral posting when gap exists
#    - Uses credit liberally (cost vs delay comparison)
#
# 3. DEADLINE_TRADER (deadline_driven_trader.json):
#    - Holds until urgency threshold (2 ticks)
#    - Compares deadline penalty vs overdraft cost
#    - Strategic late-day collateral (>70% progress)
#    - High-priority override logic
#
# 4. SMART_SPLITTER (smart_splitter.json):
#    - Splits large payments (>$3K threshold) when constrained
#    - Compares split friction vs delay and overdraft costs
#    - Tactical splitting: urgent splits up to 4-way, normal 2-way
#    - Late-day reactive collateral (>75% progress)
#
# 5. COST_OPTIMIZER (balanced_cost_optimizer.json):
#    - Time-adaptive: early/mid/late day strategies
#    - Holistic cost comparison (delay/overdraft/split/penalty/collateral)
#    - Sophisticated cost-benefit collateral decisions (>65% progress)
#    - Multi-factor decision trees with nested conditions
#
# Over 2 days (50 ticks), expect to see:
# - Day 1: Pattern establishment, policies diverge in approach
#   * AGGRESSIVE taps credit early and often
#   * DEADLINE holds then rushes near deadlines
#   * CAUTIOUS preserves buffer, accepts some delays
#   * SPLITTER splits large constrained payments
#   * OPTIMIZER balances all costs dynamically
# - Day 2: Continued stress, LSM cycles emerge, collateral strategies activate
#   * Multiple banks use collateral with different timing
#   * LSM resolves circular dependencies
#   * Payment splitting visible in transaction patterns
# - End result: High settlement rate due to LSM, diverse cost profiles across policies
