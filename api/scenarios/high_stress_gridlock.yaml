# High-Stress Gridlock Scenario
#
# This scenario creates challenging liquidity conditions to demonstrate:
# - Payment queueing due to insufficient liquidity
# - LSM bilateral offsetting
# - LSM cycle detection and resolution
# - High delay costs and overdraft penalties
# - Lower settlement rates requiring optimization

simulation:
  ticks_per_day: 100
  num_days: 1
  rng_seed: 42

agents:
  # BANK_A: Low liquidity, high volume
  - id: "BANK_A"
    opening_balance: 500000   # Only $5,000
    credit_limit: 200000      # $2,000 overdraft
    policy:
      type: "Fifo"

    arrival_config:
      rate_per_tick: 0.8  # High rate - ~80 txns/day
      amount_distribution:
        type: "Uniform"
        min: 50000   # $500 minimum (large relative to balance)
        max: 800000  # $8,000 maximum
      counterparty_weights:
        BANK_B: 0.5  # Creates cycles with BANK_B
        BANK_C: 0.3
        BANK_D: 0.2
      deadline_range: [10, 25]  # Tight deadlines
      priority: 5
      divisible: false

  # BANK_B: Low liquidity, sends back to BANK_A
  - id: "BANK_B"
    opening_balance: 600000   # $6,000
    credit_limit: 250000      # $2,500 overdraft
    policy:
      type: "Fifo"

    arrival_config:
      rate_per_tick: 0.7  # ~70 txns/day
      amount_distribution:
        type: "Uniform"
        min: 50000
        max: 750000  # $7,500 maximum
      counterparty_weights:
        BANK_A: 0.4  # Reciprocal flow with BANK_A
        BANK_C: 0.3
        BANK_D: 0.3
      deadline_range: [10, 30]
      priority: 5
      divisible: false

  # BANK_C: Very low liquidity (gridlock prone)
  - id: "BANK_C"
    opening_balance: 400000   # Only $4,000
    credit_limit: 150000      # $1,500 overdraft
    policy:
      type: "Fifo"

    arrival_config:
      rate_per_tick: 0.6  # ~60 txns/day
      amount_distribution:
        type: "Uniform"
        min: 40000
        max: 600000  # $6,000 maximum
      counterparty_weights:
        BANK_A: 0.3
        BANK_B: 0.3
        BANK_D: 0.4  # Creates cycles with BANK_D
      deadline_range: [12, 28]
      priority: 5
      divisible: false

  # BANK_D: Low liquidity, sends to BANK_C
  - id: "BANK_D"
    opening_balance: 550000   # $5,500
    credit_limit: 200000      # $2,000 overdraft
    policy:
      type: "Fifo"

    arrival_config:
      rate_per_tick: 0.65  # ~65 txns/day
      amount_distribution:
        type: "Uniform"
        min: 45000
        max: 700000  # $7,000 maximum
      counterparty_weights:
        BANK_A: 0.2
        BANK_B: 0.3
        BANK_C: 0.5  # Reciprocal with BANK_C
      deadline_range: [10, 30]
      priority: 5
      divisible: false

# LSM Configuration: Aggressive settings to resolve gridlock
lsm_config:
  bilateral_offsetting: true
  cycle_detection: true
  max_iterations: 10  # More iterations to find complex cycles

# Cost Configuration: High penalties to incentivize optimization
cost_rates:
  overdraft_bps_per_tick: 20        # 20 bps/tick for overdraft (expensive!)
  delay_cost_per_tick_per_cent: 2   # $0.02 per cent per tick in queue
  eod_penalty_per_transaction: 2000000  # $20,000 penalty for EOD failure
  deadline_penalty: 1000000         # $10,000 penalty for deadline miss
  split_friction_cost: 10000        # $100 to split
