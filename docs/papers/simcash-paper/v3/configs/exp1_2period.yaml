# Experiment 1: 2-Period Deterministic (Castro-Compliant)
#
# Validates Nash equilibrium with deferred crediting.
# Expected outcome: Bank A posts 0%, Bank B posts 20%
#
# From Castro et al. (2025) Section 4.1
#
# CASTRO-COMPLIANT: Uses liquidity_pool mode (direct balance)
# instead of max_collateral_capacity (credit headroom).

simulation:
  ticks_per_day: 2
  num_days: 1
  rng_seed: 42

# Castro paper rules
deferred_crediting: true
deadline_cap_at_eod: true

cost_rates:
  # Castro paper requires: r_c < r_d < r_b
  # Baseline: r_c = 0.1, r_d = 0.2, r_b = 0.4
  #
  # Liquidity cost: r_c = 0.1 total over 2 ticks
  # Rate per tick = 0.1 / 2 = 0.05 = 500 bps
  liquidity_cost_per_tick_bps: 500

  # Delay cost: r_d = 0.2 per unit per period
  # Cost to delay 1 unit for 1 tick is 0.2
  delay_cost_per_tick_per_cent: 0.2

  # CRITICAL: Disable overdraft - Castro has hard liquidity constraint
  # P_t × x_t ≤ ℓ_{t-1}
  overdraft_bps_per_tick: 0

  # Disable collateral cost (not using collateral mode)
  collateral_cost_per_tick_bps: 0

  # EOD penalty: r_b = 0.4 (40%)
  # Modeled as high fixed penalty to enforce "borrowing is expensive"
  eod_penalty_per_transaction: 100000

  # Deadline penalty: penalty when transaction becomes overdue
  deadline_penalty: 50000

  split_friction_cost: 0

# Disable LSM for Castro experiments
lsm_config:
  enable_bilateral: false
  enable_cycles: false

agents:
  - id: BANK_A
    opening_balance: 0
    # CRITICAL: No unsecured credit - matches paper assumption that
    # liquidity ONLY comes from liquidity_pool allocation (incurring r_c cost)
    unsecured_cap: 0
    # CASTRO-COMPLIANT: Use liquidity_pool (direct balance)
    # B = 100,000 so payments match paper fractions (P^A = [0, 0.15])
    # Bank A sends 15000 = 0.15 * B at t=1
    liquidity_pool: 100000

  - id: BANK_B
    opening_balance: 0
    unsecured_cap: 0
    # B = 100,000 so payments match paper fractions (P^B = [0.15, 0.05])
    # Bank B sends 15000 + 5000 = 20000 = 0.20 * B total
    liquidity_pool: 100000

# Deterministic transaction schedule
# Deadlines set to 2 to allow strategic delay from Tick 0 to Tick 1
scenario_events:
  # Bank A -> Bank B: 15000 at tick 1 (Period 2), deadline 2 (EOD)
  - type: CustomTransactionArrival
    from_agent: BANK_A
    to_agent: BANK_B
    amount: 15000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1

  # Bank B -> Bank A: 15000 at tick 0 (Period 1), deadline 2 (EOD)
  # Deadline 2 allows delaying this payment to Period 2
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 15000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 0

  # Bank B -> Bank A: 5000 at tick 1 (Period 2), deadline 2 (EOD)
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 5000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1