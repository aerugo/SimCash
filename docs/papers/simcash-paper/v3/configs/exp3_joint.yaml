# Experiment 3: Three-Period Dummy Example (Joint Liquidity & Timing, Castro-Compliant)
#
# Replicates Castro et al. (2025) Section 7.2:
# - P^A = P^B = [0.2, 0.2, 0] - symmetric payment demands
# - Joint learning of initial liquidity AND payment timing
# - Tests interaction between liquidity and timing decisions
#
# Uses "Scenario 1: Liquidity cheaper than delay" (r_c < r_d)
#
# CASTRO-COMPLIANT: Uses liquidity_pool mode (direct balance)
# instead of max_collateral_capacity (credit headroom).

simulation:
  ticks_per_day: 3
  num_days: 1
  rng_seed: 42

# Castro paper rules
deferred_crediting: true
deadline_cap_at_eod: true

cost_rates:
  # Castro paper requires: r_c < r_d < r_b
  # Baseline "Liquidity cheaper than delay": r_c=0.1, r_d=0.2
  #
  # Liquidity cost: r_c = 0.1 total over 3 ticks
  # Rate per tick = 0.1 / 3 ~= 0.03333 = 333 bps
  liquidity_cost_per_tick_bps: 333

  # Delay cost: r_d = 0.2 per unit per period
  delay_cost_per_tick_per_cent: 0.2

  # CRITICAL: Disable overdraft - Castro has hard liquidity constraint
  overdraft_bps_per_tick: 0

  # Disable collateral cost (not using collateral mode)
  collateral_cost_per_tick_bps: 0

  # EOD penalty: r_b > r_d
  eod_penalty_per_transaction: 100000

  # Deadline penalty: penalty when transaction becomes overdue
  deadline_penalty: 50000

  split_friction_cost: 0

# Disable LSM for Castro experiments
lsm_config:
  enable_bilateral: false
  enable_cycles: false

agents:
  - id: BANK_A
    opening_balance: 0
    unsecured_cap: 0
    # B = 100,000 collateral capacity
    # Payments are 0.2 * B = 20,000 each period
    liquidity_pool: 100000

  - id: BANK_B
    opening_balance: 0
    unsecured_cap: 0
    liquidity_pool: 100000

# Deterministic transaction schedule matching P^A = P^B = [0.2, 0.2, 0]
# Each payment is 0.2 * 100,000 = 20,000 cents
# Deadlines set to 2 (EOD) to allow strategic delay
scenario_events:
  # Period 1 (tick 0): Symmetric payments of 0.2B each
  # Bank A -> Bank B: 20000 at tick 0
  - type: CustomTransactionArrival
    from_agent: BANK_A
    to_agent: BANK_B
    amount: 20000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 0

  # Bank B -> Bank A: 20000 at tick 0
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 20000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 0

  # Period 2 (tick 1): Another 0.2B each
  # Bank A -> Bank B: 20000 at tick 1
  - type: CustomTransactionArrival
    from_agent: BANK_A
    to_agent: BANK_B
    amount: 20000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1

  # Bank B -> Bank A: 20000 at tick 1
  - type: CustomTransactionArrival
    from_agent: BANK_B
    to_agent: BANK_A
    amount: 20000
    priority: 5
    deadline: 2
    schedule:
      type: OneTime
      tick: 1

  # Period 3 (tick 2): No new payments (P_3 = 0)
  # Nothing to add