# Experiment 2: 12-Period Stochastic (LVTS-Style, Castro-Compliant)
#
# Realistic scenario with stochastic payment arrivals.
# Uses Poisson arrivals with LogNormal amounts.
#
# From Castro et al. (2025) Section 6.2 "Baseline"
#
# CASTRO-COMPLIANT: Uses liquidity_pool mode (direct balance)
# instead of max_collateral_capacity (credit headroom).

simulation:
  ticks_per_day: 12
  num_days: 1
  rng_seed: 42

# Castro paper rules
deferred_crediting: true
deadline_cap_at_eod: true

cost_rates:
  # Castro paper requires: r_c < r_d < r_b
  # Baseline parameters (Page 11): r_c = 0.1, r_d = 0.2, r_b = 0.4
  #
  # Liquidity cost: r_c = 0.1 total over 12 ticks
  # Rate per tick = 0.1 / 12 ~= 0.008333 = 83.33 bps
  liquidity_cost_per_tick_bps: 83

  # Delay cost: r_d = 0.2 per unit per period
  # Matches paper baseline 0.2
  delay_cost_per_tick_per_cent: 0.2

  # CRITICAL: Disable overdraft - Castro has hard liquidity constraint
  # P_t × x_t ≤ ℓ_{t-1}
  overdraft_bps_per_tick: 0

  # Disable collateral cost (not using collateral mode)
  collateral_cost_per_tick_bps: 0

  # EOD penalty: r_b = 0.4
  # Modeled as high fixed penalty to enforce avoidance
  eod_penalty_per_transaction: 100000

  # Deadline penalty: penalty when transaction becomes overdue
  deadline_penalty: 50000

  split_friction_cost: 0

# Disable LSM for Castro experiments
lsm_config:
  enable_bilateral: false
  enable_cycles: false

agents:
  # Scaling Note:
  # Paper Figure 6 shows optimal liquidity ~20-40% of collateral.
  # With Mean=10k, Rate=2.0, Daily Demand ~= 240k.
  # Setting Liquidity Pool (Collateral) to 1,000,000 makes demand ~24% of capacity.
  - id: BANK_A
    opening_balance: 0
    unsecured_cap: 0
    # CASTRO-COMPLIANT: Use liquidity_pool (direct balance)
    liquidity_pool: 1000000
    # Stochastic arrivals
    arrival_config:
      rate_per_tick: 2.0  # Poisson lambda
      amount_distribution:
        type: LogNormal
        mean: 10000
        std_dev: 5000
      counterparty_weights:
        BANK_B: 1.0
      deadline_range: [3, 8]  # [min_ticks, max_ticks]

  - id: BANK_B
    opening_balance: 0
    unsecured_cap: 0
    liquidity_pool: 1000000
    arrival_config:
      rate_per_tick: 2.0
      amount_distribution:
        type: LogNormal
        mean: 10000
        std_dev: 5000
      counterparty_weights:
        BANK_A: 1.0
      deadline_range: [3, 8]